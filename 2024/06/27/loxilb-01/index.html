<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/fuchencong.github.io/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/fuchencong.github.io/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/fuchencong.github.io/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/fuchencong.github.io/images/logo.svg" color="#222">

<link rel="stylesheet" href="/fuchencong.github.io/css/main.css">


<link rel="stylesheet" href="/fuchencong.github.io/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"fuchencong.github.io","root":"/fuchencong.github.io/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"right","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="最近又在研究一个 ebpf 的项目 loxilb，它是一个云原生负载均衡器，使用 Golang&#x2F;ebpf 实现，可以满足不同环境下（包括本地、公有云或 k8s 混合环境）的负载均衡需求。">
<meta property="og:type" content="article">
<meta property="og:title" content="学习 loxilb（1）：本地构建与测试">
<meta property="og:url" content="https://fuchencong.github.io/fuchencong.github.io/2024/06/27/loxilb-01/index.html">
<meta property="og:site_name" content="fuchencong">
<meta property="og:description" content="最近又在研究一个 ebpf 的项目 loxilb，它是一个云原生负载均衡器，使用 Golang&#x2F;ebpf 实现，可以满足不同环境下（包括本地、公有云或 k8s 混合环境）的负载均衡需求。">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://fuchencong.github.io/fuchencong.github.io/2024/06/27/loxilb-01/images/topo.svg">
<meta property="og:image" content="https://fuchencong.github.io/fuchencong.github.io/2024/06/27/loxilb-01/images/topo_dsr1.svg">
<meta property="og:image" content="https://fuchencong.github.io/fuchencong.github.io/2024/06/27/loxilb-01/images/topo_dsr2.svg">
<meta property="og:image" content="https://fuchencong.github.io/fuchencong.github.io/2024/06/27/loxilb-01/images/topo_dsr3.svg">
<meta property="og:image" content="https://fuchencong.github.io/fuchencong.github.io/2024/06/27/loxilb-01/images/ipip.jpg">
<meta property="article:published_time" content="2024-06-27T11:48:11.000Z">
<meta property="article:modified_time" content="2024-06-30T02:25:25.795Z">
<meta property="article:author" content="fuchencong">
<meta property="article:tag" content="ebpf">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://fuchencong.github.io/fuchencong.github.io/2024/06/27/loxilb-01/images/topo.svg">

<link rel="canonical" href="https://fuchencong.github.io/fuchencong.github.io/2024/06/27/loxilb-01/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>学习 loxilb（1）：本地构建与测试 | fuchencong</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/fuchencong.github.io/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">fuchencong</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">The way I am</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/fuchencong.github.io/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/fuchencong.github.io/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/fuchencong.github.io/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/fuchencong.github.io/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/fuchencong.github.io/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://fuchencong.github.io/fuchencong.github.io/2024/06/27/loxilb-01/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/fuchencong.github.io/images/logo.jpeg">
      <meta itemprop="name" content="fuchencong">
      <meta itemprop="description" content="Having dreams is what makes life tolerable.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fuchencong">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          学习 loxilb（1）：本地构建与测试
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2024-06-27 19:48:11" itemprop="dateCreated datePublished" datetime="2024-06-27T19:48:11+08:00">2024-06-27</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>最近又在研究一个 ebpf 的项目 <a target="_blank" rel="noopener" href="https://github.com/loxilb-io/loxilb"><code>loxilb</code></a>，它是一个云原生负载均衡器，使用 Golang&#x2F;ebpf 实现，可以满足不同环境下（包括本地、公有云或 k8s 混合环境）的负载均衡需求。</p>
<span id="more"></span>

<p>首先我们本地构建 loxilb 项目，然后再对 loxilb 进行简单功能测试，以对 loxilb 有一个快速了解。</p>
<h2 id="构建-loxilb"><a href="#构建-loxilb" class="headerlink" title="构建 loxilb"></a>构建 loxilb</h2><p>首先我们需要从 <code>loxilb</code> 仓库下载源码，因为 <code>loxilb</code> 的 ebpf 数据平面实现是在 <code>loxilb-ebpf</code> 这个子模块中，所以需要使用 <code>--recursive</code> 下载完整的代码：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># git clone --recursive https://github.com/loxilb-io/loxilb.git loxilb-debug</span></span><br><span class="line"><span class="comment"># cd loxilb-debug</span></span><br></pre></td></tr></table></figure>

<p>loxilb 也是通过 <code>github workflow</code> 来进行持续集成（CI）的，同时 <code>loxilb</code> 源码目录下的 <code>cicd/</code> 子目录中提供了大量自动化测试脚本，每次代码变更都会触发 CI 流量来运行这些测试脚本。所以熟悉 <code>cicd/</code> 目录下的测试脚本，也可以帮助我们快速了解、测试 loxilb 的功能。</p>
<p>为了在我本地 Ubuntu 22.04 机器上构建并运行 <code>loxilb</code>，我直接参考 <code>loxilb</code> 目录下的 <code>.github/workflows/tcp-sanity-ubuntu-22.yml</code> 工作流，这样就可以让我的本地测试环境尽可能与官方 CI 环境保持一致。</p>
<ul>
<li>安装 Python 和 Golang</li>
</ul>
<p>根据 workflow 文件，在 check out 代码后，会安装 Python 和 Golang 环境，Golang 版本需要在 <code>1.18</code> 以上。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">- uses: actions/checkout@v2</span><br><span class="line">  with:</span><br><span class="line">    submodules: recursive</span><br><span class="line">- uses: actions/setup-python@v2</span><br><span class="line">- uses: actions/setup-go@v3</span><br><span class="line">  with:</span><br><span class="line">       go-version: <span class="string">&#x27;&gt;=1.18.0&#x27;</span></span><br></pre></td></tr></table></figure>

<p>由于我本地已经安装 Python 和 Golang，这一步就跳过：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># python --version</span></span><br><span class="line">Python 3.10.12</span><br><span class="line"><span class="comment"># go version</span></span><br><span class="line">go version go1.22.0 linux/amd64</span><br></pre></td></tr></table></figure>

<ul>
<li>安装其他依赖组件</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># apt-get update</span></span><br><span class="line"><span class="comment"># apt-get -y install clang llvm libelf-dev gcc-multilib libpcap-dev linux-tools-$(uname -r) elfutils dwarves git libbsd-dev bridge-utils unzip build-essential bison flex iperf iproute2 nodejs socat ethtool</span></span><br></pre></td></tr></table></figure>

<ul>
<li>构建并安装 loxilb 自己的 <a target="_blank" rel="noopener" href="https://github.com/loxilb-io/iproute2">tc</a>，称为 <code>ntc</code></li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># cd loxilb-debug</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装 libbpf</span></span><br><span class="line"><span class="comment"># git clone --recurse-submodules https://github.com/loxilb-io/iproute2 iproute2-main</span></span><br><span class="line"><span class="comment"># cd iproute2-main/libbpf/src/</span></span><br><span class="line"><span class="comment"># make install</span></span><br><span class="line"><span class="comment"># mkdir build</span></span><br><span class="line"><span class="comment"># DESTDIR=build OBJDIR=build make install</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 构建 iproute2 中的 tc</span></span><br><span class="line"><span class="comment"># cd -</span></span><br><span class="line"><span class="comment"># cd iproute2-main/</span></span><br><span class="line"><span class="comment"># export PKG_CONFIG_PATH=$PKG_CONFIG_PATH:`pwd`/libbpf/src/ &amp;&amp; LIBBPF_FORCE=on LIBBPF_DIR=`pwd`/libbpf/src/build ./configure &amp;&amp; make &amp;&amp; sudo cp -f tc/tc /usr/local/sbin/ntc &amp;&amp; cd -</span></span><br></pre></td></tr></table></figure>

<ul>
<li>挂载好 loxilb 使用的 bpf 文件系统</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># loxilb-ebpf/utils/mkllb_bpffs.sh</span></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># mount -l | grep loxilb</span></span><br><span class="line">bpf on /opt/loxilb/dp <span class="built_in">type</span> bpf (rw,relatime)</span><br></pre></td></tr></table></figure>

<ul>
<li>构建 loxilb 并执行测试</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">env</span> <span class="string">&quot;PATH=<span class="variable">$PATH</span>&quot;</span> make</span><br><span class="line"><span class="built_in">env</span> <span class="string">&quot;PATH=<span class="variable">$PATH</span>&quot;</span> make <span class="built_in">test</span></span><br></pre></td></tr></table></figure>

<ul>
<li>基于生成的交付件，生成适用于本地环境的 docker 镜像，并对镜像打上 tag <code>latestu22</code></li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># docker pull ghcr.io/loxilb-io/loxilb:latest</span></span><br><span class="line"><span class="comment"># docker run -u root --cap-add SYS_ADMIN   --restart unless-stopped --privileged -dit -v /dev/log:/dev/log --name loxilb ghcr.io/loxilb-io/loxilb:latestu22</span></span><br><span class="line"><span class="comment"># pwd &amp;&amp; ls &amp;&amp; sudo -E env &quot;PATH=$PATH&quot; make docker-cp-ebpf</span></span><br><span class="line"><span class="comment"># docker exec -dit loxilb mkllb_bpffs</span></span><br><span class="line"><span class="comment"># id=`docker ps -f name=loxilb | cut  -d &quot; &quot;  -f 1 | grep -iv  &quot;CONTAINER&quot;` &amp;&amp; docker commit $id ghcr.io/loxilb-io/loxilb:latest</span></span><br><span class="line"><span class="comment"># docker stop loxilb &amp;&amp; docker rm loxilb &amp;&amp; docker image tag ghcr.io/loxilb-io/loxilb:latest ghcr.io/loxilb-io/loxilb:latestu22</span></span><br></pre></td></tr></table></figure>

<p>这样我们就在本地构建好了 <code>loxlilb</code> 镜像，之后所有的测试都将基于 docker 镜像进行测试。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># docker images | grep loxilb</span></span><br><span class="line">ghcr.io/loxilb-io/loxilb                                           latest                                 dec558036925   2 hours ago     316MB</span><br><span class="line">ghcr.io/loxilb-io/loxilb                                           latestu22                              dec558036925   2 hours ago     316MB</span><br></pre></td></tr></table></figure>

<h2 id="四层-LB-基础功能测试"><a href="#四层-LB-基础功能测试" class="headerlink" title="四层 LB 基础功能测试"></a>四层 LB 基础功能测试</h2><p>接下来我们就使用这个构建好的 <code>loxilb</code> 镜像来测试最基本的四层负载均衡功能。继续看 <code>.github/workflows/tcp-sanity-ubuntu-22.yml</code> 这个工作流，它在完成 <code>loxilb</code> 进行构建后，就开始执行 <code>cicd/</code> 目录下的一系列测试脚本，这个 workflow 一共执行 <code>cicd/tcplb/</code>、<code>cicd/tcplbmark/</code>、<code>cicd/tcplbdsr1/</code>、<code>cicd/tcplbdsr2/</code>、<code>cicd/tcplbl3dsr/</code>、<code>cicd/tcplbhash/</code> 这几个测试 case，每个测试 case 都是按照如下步骤进行：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 搭建测试环境</span></span><br><span class="line"><span class="comment"># ./config.sh</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 验证功能</span></span><br><span class="line"><span class="comment"># ./validation.sh</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 清理测试环境</span></span><br><span class="line"><span class="comment"># ./rmconfig.sh</span></span><br></pre></td></tr></table></figure>

<p>接下来我们就手动执行 <code>cicd/tcplb/</code> 目录下的测试流程，看看是否能够正常执行。</p>
<h3 id="搭建测试环境"><a href="#搭建测试环境" class="headerlink" title="搭建测试环境"></a>搭建测试环境</h3><p>首先执行 <code>.config.sh</code> 脚本搭建测试环境：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># cd cicd/tcplb</span></span><br><span class="line"> ./config.sh</span><br></pre></td></tr></table></figure>

<p><code>.config.sh</code> 脚本主要完成了以下工作：</p>
<ul>
<li>创建一个作为负载均衡器的 <code>loxilb</code> 容器，名为 <code>llb1</code></li>
<li>创建一个作为 client 的 <code>host</code> 容器，名为 <code>l3h1</code></li>
<li>创建三个作为 endpoint 的 <code>host</code> 容器，名为 <code>l3ep1</code>、<code>l3ep2</code> 和 <code>l3ep3</code></li>
<li>另外，该脚本还会将每个容器的 netns mount 到 <code>/var/run/netns</code> 目录下，这样后续可以直接在宿主机上通过 <code>ip netns</code> 命令操作不同容器的网络配置（学到了~~）。这段脚本代码如下：</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># dname 表示容器名称</span></span><br><span class="line">get_docker_pid <span class="variable">$dname</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$pid</span></span><br><span class="line"><span class="keyword">if</span> [ ! -f <span class="string">&quot;<span class="variable">$hexist</span>/<span class="variable">$dname</span>&quot;</span> -a <span class="string">&quot;<span class="variable">$pid</span>&quot;</span> != <span class="string">&quot;&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">  sudo <span class="built_in">mkdir</span> -p /var/run/netns</span><br><span class="line">  sudo <span class="built_in">touch</span> /var/run/netns/<span class="variable">$dname</span></span><br><span class="line">  <span class="comment">#echo &quot;sudo mount -o bind /proc/$pid/ns/net /var/run/netns/$2&quot;</span></span><br><span class="line">  sudo mount -o <span class="built_in">bind</span> /proc/<span class="variable">$pid</span>/ns/net /var/run/netns/<span class="variable">$dname</span></span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>

<ul>
<li>通过 <code>veth pair</code> 将 <code>l3h1</code> 和 <code>llb1</code>、<code>llb1</code> 和 <code>l3ep1</code>、<code>llb1</code> 和 <code>l3ep2</code>、<code>llb1</code> 和 <code>l3ep3</code> 连接起来，并配置 IP 地址，实现 L3 互通</li>
<li>在 <code>llb1</code> 容器中执行 <code>loxicmd</code> 命令，添加 LB 规则，总共添加了如下 3 条 LB 规则</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">create_lb_rule llb1 20.20.20.1 --tcp=2020:8080 --endpoints=31.31.31.1:1,32.32.32.1:1,33.33.33.1:1</span><br><span class="line">create_lb_rule llb1 10.10.10.254 --tcp=2020:8080 --endpoints=31.31.31.1:1,32.32.32.1:1,33.33.33.1:1</span><br><span class="line">create_lb_rule llb1 10.10.10.3 --tcp=2020:8080 --endpoints=31.31.31.1:1,32.32.32.1:1,33.33.33.1:1</span><br></pre></td></tr></table></figure>

<p>经过上述脚本后，就搭建了如下网络拓扑，并且添加了 3 条 LB 转发规则：</p>
<img src="/fuchencong.github.io/2024/06/27/loxilb-01/images/topo.svg" class="">

<p>我们可以实际检查下这些配置的确生效：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># docker exec -it l3h1 ip -br addr show</span></span><br><span class="line">lo               UNKNOWN        127.0.0.1/8</span><br><span class="line">el3h1llb1@if6    UP             10.10.10.1/24</span><br><span class="line">eth0@if66        UP             172.17.0.6/16</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># docker exec -it llb1 ip -br addr show</span></span><br><span class="line">lo               UNKNOWN        127.0.0.1/8 10.10.10.3/32</span><br><span class="line">llb0             UNKNOWN</span><br><span class="line">ellb1l3ep1@if2   UP             31.31.31.254/24</span><br><span class="line">ellb1l3ep2@if2   UP             32.32.32.254/24</span><br><span class="line">ellb1l3ep3@if2   UP             33.33.33.254/24</span><br><span class="line">ellb1l3h1@if2    UP             10.10.10.254/24</span><br><span class="line">eth0@if58        UP             172.17.0.2/16</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># docker exec -it l3ep1 ip -br addr show</span></span><br><span class="line">lo               UNKNOWN        127.0.0.1/8</span><br><span class="line">el3ep1llb1@if3   UP             31.31.31.1/24</span><br><span class="line">eth0@if60        UP             172.17.0.3/16</span><br><span class="line"></span><br><span class="line"><span class="comment"># docker exec -it l3ep2 ip -br addr show</span></span><br><span class="line">lo               UNKNOWN        127.0.0.1/8</span><br><span class="line">el3ep2llb1@if4   UP             32.32.32.1/24</span><br><span class="line">eth0@if62        UP             172.17.0.4/16</span><br><span class="line"></span><br><span class="line"><span class="comment"># docker exec -it l3ep3 ip -br addr show</span></span><br><span class="line">lo               UNKNOWN        127.0.0.1/8</span><br><span class="line">el3ep3llb1@if5   UP             33.33.33.1/24</span><br><span class="line">eth0@if64        UP             172.17.0.5/16</span><br></pre></td></tr></table></figure>

<p>在 <code>loxilb</code> 容器中执行 <code>loxicmd</code> 命令，可以查看 LB 相关配置：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># docker exec -it loxilb /bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># loxicmd get loadbalancer</span></span><br><span class="line">|    EXT IP    | PORT | PROTO | NAME | MARK | SEL |  MODE   | <span class="comment"># OF ENDPOINTS | MONITOR |</span></span><br><span class="line">|--------------|------|-------|------|------|-----|---------|----------------|---------|</span><br><span class="line">| 10.10.10.254 | 2020 | tcp   |      |    0 | rr  | default |              3 | Off     |</span><br><span class="line">| 10.10.10.3   | 2020 | tcp   |      |    0 | rr  | default |              3 | Off     |</span><br><span class="line">| 20.20.20.1   | 2020 | tcp   |      |    0 | rr  | default |              3 | Off     |</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># loxicmd get endpoint</span></span><br><span class="line">|    HOST    |        NAME         | PTYPE | PORT | DURATION | RETRIES | MINDELAY | AVGDELAY | MAXDELAY | STATE |</span><br><span class="line">|------------|---------------------|-------|------|----------|---------|----------|----------|----------|-------|</span><br><span class="line">| 31.31.31.1 | 31.31.31.1_tcp_8080 | none: | 8080 |        0 |       0 |          |          |          | ok    |</span><br><span class="line">| 32.32.32.1 | 32.32.32.1_tcp_8080 | none: | 8080 |        0 |       0 |          |          |          | ok    |</span><br><span class="line">| 33.33.33.1 | 33.33.33.1_tcp_8080 | none: | 8080 |        0 |       0 |          |          |          | ok    |</span><br></pre></td></tr></table></figure>

<h3 id="运行测试"><a href="#运行测试" class="headerlink" title="运行测试"></a>运行测试</h3><p>接下来运行该测试流程中的 <code>验证脚本</code>，即 <code>validation.sh</code>，它首先分别在三个 endpoint 容器中启动 HTTP 服务，不同 endpoint 容器里的 HTTP 服务会返回不同的字符串，这样方便我们判断是哪个 endpoint 容器处理了 HTTP 请求。</p>
<p>其实 <code>validation.sh</code> 脚本的主要工作就是访问该 LB 提供的三个 VIP，并检查每次访问 LB 的 VIP 时，LB 都是按照 RR 轮询算法将请求转发到不同的 endpoint 容器。我们也可以手动完成这个测试：</p>
<ul>
<li>首先在三个 endpoint 容器中启动 HTTP 服务</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">hexec=<span class="string">&quot;sudo ip netns exec &quot;</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$hexec</span> l3ep1 node ../common/tcp_server.js server1 &amp;</span><br><span class="line"><span class="variable">$hexec</span> l3ep2 node ../common/tcp_server.js server2 &amp;</span><br><span class="line"><span class="variable">$hexec</span> l3ep3 node ../common/tcp_server.js server3 &amp;</span><br></pre></td></tr></table></figure>

<ul>
<li>从 <code>l3h1</code> 中通过 curl 访问 LB 的 VIP</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># $hexec l3h1 curl --max-time 10  10.10.10.254:2020</span></span><br><span class="line">server1</span><br><span class="line"><span class="comment"># $hexec l3h1 curl --max-time 10  10.10.10.254:2020</span></span><br><span class="line">server2</span><br><span class="line"><span class="comment"># $hexec l3h1 curl --max-time 10  10.10.10.254:2020</span></span><br><span class="line">server3</span><br><span class="line"></span><br><span class="line"><span class="comment"># $hexec l3h1 curl --max-time 10  10.10.10.3:2020</span></span><br><span class="line">server1</span><br><span class="line"><span class="comment"># $hexec l3h1 curl --max-time 10  10.10.10.3:2020</span></span><br><span class="line">server2</span><br><span class="line"><span class="comment"># $hexec l3h1 curl --max-time 10  10.10.10.3:2020</span></span><br><span class="line">server3</span><br><span class="line"></span><br><span class="line"><span class="comment"># $hexec l3h1 curl --max-time 10  20.20.20.1:2020</span></span><br><span class="line">server1</span><br><span class="line"><span class="comment"># $hexec l3h1 curl --max-time 10  20.20.20.1:2020</span></span><br><span class="line">server2</span><br><span class="line"><span class="comment"># $hexec l3h1 curl --max-time 10  20.20.20.1:2020</span></span><br><span class="line">server3</span><br></pre></td></tr></table></figure>

<p>这里说明一下为什么能够从 <code>l3h1</code> 访问 <code> 20.20.20.1</code> 这个 VIP，因为 <code>l3h1</code> 里默认路由就是通过 <code>llb1</code> 转发：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># $hexec l3h1 ip route</span></span><br><span class="line">default via 10.10.10.254 dev el3h1llb1</span><br><span class="line">10.10.10.0/24 dev el3h1llb1 proto kernel scope <span class="built_in">link</span> src 10.10.10.1</span><br><span class="line">172.17.0.0/16 dev eth0 proto kernel scope <span class="built_in">link</span> src 172.17.0.6</span><br></pre></td></tr></table></figure>

<h3 id="抓包分析"><a href="#抓包分析" class="headerlink" title="抓包分析"></a>抓包分析</h3><p>当我们在 <code>l3h1</code> 容器通过curl 访问 <code>20.20.20.1.2020</code><br>我们在 <code>llb1</code> 容器内对流量进行抓包，看下 <code>llb1</code> 到底是怎么对四层流量进行负载分担的：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># $hexec llb1 tcpdump -i any -n -l</span></span><br><span class="line">tcpdump: data <span class="built_in">link</span> <span class="built_in">type</span> LINUX_SLL2</span><br><span class="line">tcpdump: verbose output suppressed, use -v[v]... <span class="keyword">for</span> full protocol decode</span><br><span class="line"><span class="comment"># 收到 l3h1 的 SYN 包</span></span><br><span class="line">listening on any, link-type LINUX_SLL2 (Linux cooked v2), snapshot length 262144 bytes</span><br><span class="line">18:37:10.337301 ellb1l3h1 In  IP 10.10.10.1.38148 &gt; 20.20.20.1.2020: Flags [S], <span class="built_in">seq</span> 4098335908, win 62720, options [mss 8960,sackOK,TS val 3345845189 ecr 0,nop,wscale 7], length 0</span><br><span class="line"></span><br><span class="line"><span class="comment"># llb1 通过 DNAT，将目的 IP 从 20.20.20.1 改为 33.33.33.1，目的 Port 从 2020 改为 8080</span></span><br><span class="line">18:37:10.337323 ellb1l3ep3 Out IP 10.10.10.1.38148 &gt; 33.33.33.1.8080: Flags [S], <span class="built_in">seq</span></span><br><span class="line">4098335908, win 62720, options [mss 8960,sackOK,TS val 3345845189 ecr 0,nop,wscale 7], length 0</span><br><span class="line"></span><br><span class="line"><span class="comment"># 收到 l3ep3 的 SYN/ACK 包</span></span><br><span class="line">18:37:10.337336 ellb1l3ep3 In  IP 33.33.33.1.8080 &gt; 10.10.10.1.38148: Flags [S.], <span class="built_in">seq</span> 576370836, ack 4098335909, win 62636, options [mss 8960,sackOK,TS val 3915933462 ecr 3345845189,nop,wscale 7], length 0</span><br><span class="line"></span><br><span class="line"><span class="comment"># llb1 将 SYN/ACK 回包的源 IP 从 33.33.33.1 改为 20.20.20.1，源 Port 从 8080 改为 2020</span></span><br><span class="line">18:37:10.337344 ellb1l3h1 Out IP 20.20.20.1.2020 &gt; 10.10.10.1.38148: Flags [S.], <span class="built_in">seq</span> 576370836, ack 4098335909, win 62636, options [mss 8960,sackOK,TS val 3915933462 ecr 3345845189,nop,wscale 7], length 0</span><br><span class="line">......</span><br></pre></td></tr></table></figure>

<p>可以看到，<code>loxilb</code> 默认通过 NAT 模式来实现四层负载分担。</p>
<h3 id="移除测试环境"><a href="#移除测试环境" class="headerlink" title="移除测试环境"></a>移除测试环境</h3><p>在完成测试之后，只需要运行 <code>./rmconfig.sh</code> 即可完成本次测试环境的移除。</p>
<h2 id="其他测试"><a href="#其他测试" class="headerlink" title="其他测试"></a>其他测试</h2><p><code>cicd/tcplb/</code> 只是 <code>tcp-sanity-ubuntu-22.yml</code> 工作流中的第一个测试 case，接下来简单介绍下剩余测试 case 的功能：</p>
<ul>
<li><code>cicd/tcplbmark/</code>：测试 <code>firewall</code> 规则以及 <code>LB</code> 规则中的 mark 选项</li>
<li><code>cicd/tcplbdsr1/</code>：基本的 DSR 功能测试</li>
<li><code>cicd/tcplbdsr2/</code>：回包不过 LB 的 DSR 测试</li>
<li><code>cicd/tcplbl3dsr/</code>：IPIP 隧道模式功能测试</li>
<li><code>cicd/tcplbhash/</code>：测试 LB <code>hash</code> balance 算法</li>
</ul>
<p>我们重点看这几个与 LB DSR 模式相关的测试 case。</p>
<h3 id="cicd-tcplbdsr1"><a href="#cicd-tcplbdsr1" class="headerlink" title="cicd/tcplbdsr1/"></a><code>cicd/tcplbdsr1/</code></h3><p>在该测试 case 中，搭建了如下网络拓扑：</p>
<img src="/fuchencong.github.io/2024/06/27/loxilb-01/images/topo_dsr1.svg" class="">

<p>并且在 LB 上添加了如下 LB 规则，可以看到使用 <code>dsr</code> 模式，负载均衡算法使用 <code>hash</code>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$dexec</span> llb1 loxicmd create lb 20.20.20.1 --select=<span class="built_in">hash</span> --tcp=2020:2020 --endpoints=31.31.31.1:1,32.32.32.1:1,33.33.33.1:1 --mode=dsr</span><br></pre></td></tr></table></figure>

<p>我们查看在 LB 上抓到的包：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># $hexec llb1 tcpdump -e -i ellb1l3h1 -n -l</span></span><br><span class="line">tcpdump: verbose output suppressed, use -v[v]... <span class="keyword">for</span> full protocol decode</span><br><span class="line">listening on ellb1l3h1, link-type EN10MB (Ethernet), snapshot length 262144 bytes</span><br><span class="line"><span class="comment"># 1. 收到 l3h1 的 SYN 包，源 MAC 是 l3h1 的 el3h1llb1 Mac，目的 Mac 是 llb1 的 ellb1l3h1 Mac</span></span><br><span class="line">12:07:34.475433 26:d9:99:b2:d4:d3 &gt; 4a:8b:6d:bb:db:fb, ethertype IPv4 (0x0800), length 74: 10.10.10.1.55001 &gt; 20.20.20.1.2020: Flags [S], <span class="built_in">seq</span> 676983821, win 62720, options [mss 8960,sackOK,TS val 3408869327 ecr 0,nop,wscale 7], length 0</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4. 转发 l3ep3 回复的 SYN/ACK 包，源 MAC 是  llb1 的 ellb1l3h1 Mac，目的 Mac 是 l3h1 的 el3h1llb1 Mac</span></span><br><span class="line">12:07:34.475481 4a:8b:6d:bb:db:fb &gt; 26:d9:99:b2:d4:d3, ethertype IPv4 (0x0800), length 74: 20.20.20.1.2020 &gt; 10.10.10.1.55001: Flags [S.], <span class="built_in">seq</span> 2169622033, ack 676983822, win 62636, options [mss 8960,sackOK,TS val 2224496444 ecr 3408869327,nop,wscale 7], length 0</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># $hexec llb1 tcpdump -e -i ellb1l3ep3 -n -l</span></span><br><span class="line">tcpdump: verbose output suppressed, use -v[v]... <span class="keyword">for</span> full protocol decode</span><br><span class="line">listening on ellb1l3ep3, link-type EN10MB (Ethernet), snapshot length 262144 bytes</span><br><span class="line"><span class="comment"># 2. 修改 SYN 包的目的 Mac 为 l3ep3 的 el3ep3llb1 Mac，而源 Mac 则是 llb1 的 ellb1l3ep3 Mac</span></span><br><span class="line"><span class="comment"># SYN 包的目的 IP/端口均没有发生变化</span></span><br><span class="line">12:07:34.475457 96:be:34:74:c7:f3 &gt; 56:b7:3b:3e:<span class="built_in">cd</span>:7b, ethertype IPv4 (0x0800), length 74: 10.10.10.1.55001 &gt; 20.20.20.1.2020: Flags [S], <span class="built_in">seq</span> 676983821, win 62720, options [mss 8960,sackOK,TS val 3408869327 ecr 0,nop,wscale 7], length 0</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. 收到 l3ep3 的 SYN/ACK 包，源 MAC 是 l3ep3 的 el3ep3llb1 Mac，目的 Mac 是 llb1 的 ellb1l3ep3 Mac</span></span><br><span class="line">12:07:34.475472 56:b7:3b:3e:<span class="built_in">cd</span>:7b &gt; 96:be:34:74:c7:f3, ethertype IPv4 (0x0800), length 74: 20.20.20.1.2020 &gt; 10.10.10.1.55001: Flags [S.], <span class="built_in">seq</span> 2169622033, ack 676983822, win 62636, options [mss 8960,sackOK,TS val 2224496444 ecr 3408869327,nop,wscale 7], length 0</span><br></pre></td></tr></table></figure>

<p>可以看到 DSR 模式下，Endpoint 都在 lo 口上配置了 VIP <code>20.20.20.1</code>，llb1 在收到报文后，直接修改报文的目的 Mac，即可将报文转发到 Endpoint 上。在这个拓扑下，Endpoint 的回包也会通过 llb1 转发，而不是直接从 endpoint 回复给 l3h1。</p>
<h3 id="cicd-tcplbdsr2"><a href="#cicd-tcplbdsr2" class="headerlink" title="cicd/tcplbdsr2/"></a><code>cicd/tcplbdsr2/</code></h3><p>上一个 case 的 DSR 模式，Endpoint 的回包是通过 llb1 转发的。而在这个 case中，Endpoint 的回包是直接回到 l3h1 上的。本 case 搭建了如下网络拓扑：</p>
<img src="/fuchencong.github.io/2024/06/27/loxilb-01/images/topo_dsr2.svg" class="">

<p>增加了如下 LB 规则：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$dexec</span> llb1 loxicmd create lb 20.20.20.1 --select=<span class="built_in">hash</span> --tcp=2020:2020 --endpoints=31.31.31.1:1,32.32.32.1:1,33.33.33.1:1 --mode=dsr</span><br></pre></td></tr></table></figure>

<p>可以先看下 l3h1 和 l3ep1 的路由配置：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># $hexec l3h1 ip route</span></span><br><span class="line">default via 10.10.10.254 dev el3h1llb1</span><br><span class="line">10.10.10.0/24 dev el3h1llb1 proto kernel scope <span class="built_in">link</span> src 10.10.10.1</span><br><span class="line">11.11.11.0/24 dev vlan11 proto kernel scope <span class="built_in">link</span> src 11.11.11.254</span><br><span class="line">172.17.0.0/16 dev eth0 proto kernel scope <span class="built_in">link</span> src 172.17.0.3</span><br><span class="line"></span><br><span class="line"><span class="comment"># $hexec l3ep1 ip route</span></span><br><span class="line">default via 31.31.31.254 dev el3ep1llb1</span><br><span class="line">10.10.10.0/24 via 11.11.11.254 dev vlan11</span><br><span class="line">11.11.11.0/24 dev vlan11 proto kernel scope <span class="built_in">link</span> src 11.11.11.1</span><br><span class="line">31.31.31.0/24 dev el3ep1llb1 proto kernel scope <span class="built_in">link</span> src 31.31.31.1</span><br><span class="line">172.17.0.0/16 dev eth0 proto kernel scope <span class="built_in">link</span> src 172.17.0.4</span><br></pre></td></tr></table></figure>

<p>在看下整个拓扑的 vlan 配置：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># $hexec l3h1 ip -br addr show vlan11</span></span><br><span class="line">vlan11           UP             11.11.11.254/24</span><br><span class="line"><span class="comment"># $hexec l3h1 brctl show vlan11</span></span><br><span class="line">bridge name     bridge <span class="built_in">id</span>               STP enabled     interfaces</span><br><span class="line">vlan11          8000.c2decb6b4135       no              el3h1sw1</span><br><span class="line"></span><br><span class="line"><span class="comment"># $hexec sw1 brctl show vlan11</span></span><br><span class="line">bridge name     bridge <span class="built_in">id</span>               STP enabled     interfaces</span><br><span class="line">vlan11          8000.46f2213b1deb       no              esw1l3ep1</span><br><span class="line">                                                        esw1l3ep2</span><br><span class="line">                                                        esw1l3ep3</span><br><span class="line">                                                        esw1l3h1</span><br><span class="line"><span class="comment"># $hexec l3ep1 ip -br addr show vlan11</span></span><br><span class="line">vlan11           UP             11.11.11.1/24</span><br><span class="line"><span class="comment"># $hexec l3ep1 brctl show vlan11</span></span><br><span class="line">bridge name     bridge <span class="built_in">id</span>               STP enabled     interfaces</span><br><span class="line">vlan11          8000.0a96b4aa4683       no              el3ep1sw1</span><br><span class="line">......</span><br></pre></td></tr></table></figure>

<p>从路由可以看出，<code>l3h1</code> 的访问 VIP 的报文是通过 el3ep1llb1 到达 LB，LB 在 DSR 模式下修改报文的目的 Mac，并将报文转发到某个 Endpoint，而根据 Endpoint 的路由来看，发往 <code>10.10.10.0/24</code> 网段的报文是通过 vlan11 发送，这样经由 sw1 上的 vlan bridge 二层转发后，到达 <code>l3h1</code>。由于收发包路径不一致，需要对 <code>rp_filter</code> 做特殊设置，将其设置为 0，以关闭反向路由检测。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$hexec</span> l3h1 sysctl net.ipv4.conf.all.rp_filter=0 2&gt;&amp;1 &gt;&gt; /dev/null</span><br><span class="line"><span class="variable">$hexec</span> l3h1 sysctl net.ipv4.conf.vlan11.rp_filter=0 2&gt;&amp;1 &gt;&gt; /dev/null</span><br><span class="line"><span class="variable">$hexec</span> l3ep1 sysctl net.ipv4.conf.el3ep1llb1.rp_filter=0 2&gt;&amp;1 &gt;&gt; /dev/null</span><br><span class="line"><span class="variable">$hexec</span> l3ep2 sysctl net.ipv4.conf.el3ep2llb1.rp_filter=0 2&gt;&amp;1 &gt;&gt; /dev/null</span><br><span class="line"><span class="variable">$hexec</span> l3ep3 sysctl net.ipv4.conf.el3ep3llb1.rp_filter=0 2&gt;&amp;1 &gt;&gt; /dev/null</span><br></pre></td></tr></table></figure>

<p>通过抓包验证以下该流程：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># $hexec llb1 tcpdump -e -i ellb1l3h1  -n -l tcp</span></span><br><span class="line">tcpdump: verbose output suppressed, use -v[v]... <span class="keyword">for</span> full protocol decode</span><br><span class="line">listening on ellb1l3h1, link-type EN10MB (Ethernet), snapshot length 262144 bytes</span><br><span class="line"><span class="comment"># 1. llb1 上的 ellb1l3h1 收到 l3h1 发来的 SYN 包</span></span><br><span class="line">16:26:58.521744 e6:d3:aa:9a:f8:a2 &gt; 02:26:41:c3:98:15, ethertype IPv4 (0x0800), length 74: 10.10.10.1.55001 &gt; 20.20.20.1.2020: Flags [S], <span class="built_in">seq</span> 3347038838, win 62720, options [mss 8960,sackOK,TS val 3424433373 ecr 0,nop,wscale 7], length 0</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># $hexec llb1 tcpdump -e -i ellb1l3ep3  -n -l tcp</span></span><br><span class="line">tcpdump: verbose output suppressed, use -v[v]... <span class="keyword">for</span> full protocol decode</span><br><span class="line">listening on ellb1l3ep3, link-type EN10MB (Ethernet), snapshot length 262144 bytes</span><br><span class="line"><span class="comment"># 2. llb1 上的 ellb1l3ep3 转发该 SYN 包给 l3ep3</span></span><br><span class="line">16:26:58.521768 5a:60:8e:64:da:33 &gt; 82:dc:87:59:bb:fe, ethertype IPv4 (0x0800), length 74: 10.10.10.1.55001 &gt; 20.20.20.1.2020: Flags [S], <span class="built_in">seq</span> 3347038838, win 62720, options [mss 8960,sackOK,TS val 3424433373 ecr 0,nop,wscale 7], length 0</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># $hexec sw1 tcpdump -e -i vlan11  -n -l tcp</span></span><br><span class="line">tcpdump: verbose output suppressed, use -v[v]... <span class="keyword">for</span> full protocol decode</span><br><span class="line">listening on vlan11, link-type EN10MB (Ethernet), snapshot length 262144 bytes</span><br><span class="line"><span class="comment"># 3. sw1 上的 vlan11 网桥负责对 l3ep3 回复的 SYN/ACK 包进行二层转发</span></span><br><span class="line">16:26:58.521789 de:aa:21:3a:4a:f3 &gt; c2:de:cb:6b:41:35, ethertype IPv4 (0x0800), length 74: 20.20.20.1.2020 &gt; 10.10.10.1.55001: Flags [S.], <span class="built_in">seq</span> 544709783, ack 3347038839, win 62636, options [mss 8960,sackOK,TS val 2240060490 ecr 3424433373,nop,wscale 7], length 0</span><br></pre></td></tr></table></figure>

<h3 id="cicd-tcplbl3dsr"><a href="#cicd-tcplbl3dsr" class="headerlink" title="cicd/tcplbl3dsr/"></a><code>cicd/tcplbl3dsr/</code></h3><p>这个测试 case 在 LB 上使用 L3 ipip 隧道来实现 DSR 模式，即通过 ipip 隧道将流量转发到 Endpoint 上，其实就是一般所说的 LVS 的 IP 隧道模式。测试 case 的拓扑如下：</p>
<img src="/fuchencong.github.io/2024/06/27/loxilb-01/images/topo_dsr3.svg" class="">

<p>增加了如下 LB 规则：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">create_lb_rule llb1 20.20.20.1 --select=<span class="built_in">hash</span> --tcp=8080:8080 --endpoints=56.56.56.1:1,57.57.57.1:1,58.58.58.1:1 --mode=dsr</span><br></pre></td></tr></table></figure>

<p>查看 LB 上的配置：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># $dexec llb1 ip -br link show</span></span><br><span class="line">lo               UNKNOWN        00:00:00:00:00:00 &lt;LOOPBACK,UP,LOWER_UP&gt;</span><br><span class="line">llb0             UNKNOWN        52:68:57:6d:45:ba &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt;</span><br><span class="line">ellb1l3h1@if2    UP             12:b9:f5:99:4e:3c &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt;</span><br><span class="line">ellb1l3ep1@if2   UP             9e:8d:30:a8:be:82 &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt;</span><br><span class="line">ellb1l3ep2@if2   UP             be:24:7e:c4:38:51 &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt;</span><br><span class="line">ellb1l3ep3@if2   UP             96:13:7e:39:d2:c2 &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt;</span><br><span class="line">tunl0@NONE       DOWN           0.0.0.0 &lt;NOARP&gt;</span><br><span class="line">ipip0@NONE       UNKNOWN        31.31.31.254 &lt;POINTOPOINT,NOARP,UP,LOWER_UP&gt;</span><br><span class="line">ipip1@NONE       UNKNOWN        32.32.32.254 &lt;POINTOPOINT,NOARP,UP,LOWER_UP&gt;</span><br><span class="line">ipip2@NONE       UNKNOWN        33.33.33.254 &lt;POINTOPOINT,NOARP,UP,LOWER_UP&gt;</span><br><span class="line">eth0@if112       UP             02:42:ac:11:00:02 &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># $dexec llb1 ip -br addr show</span></span><br><span class="line">lo               UNKNOWN        127.0.0.1/8</span><br><span class="line">llb0             UNKNOWN</span><br><span class="line">ellb1l3h1@if2    UP             10.10.10.254/24</span><br><span class="line">ellb1l3ep1@if2   UP             31.31.31.254/24</span><br><span class="line">ellb1l3ep2@if2   UP             32.32.32.254/24</span><br><span class="line">ellb1l3ep3@if2   UP             33.33.33.254/24</span><br><span class="line">tunl0@NONE       DOWN</span><br><span class="line">ipip0@NONE       UNKNOWN        45.45.45.254/24</span><br><span class="line">ipip1@NONE       UNKNOWN        46.46.46.254/24</span><br><span class="line">ipip2@NONE       UNKNOWN        47.47.47.254/24</span><br><span class="line">eth0@if112       UP             172.17.0.2/16</span><br><span class="line"></span><br><span class="line"><span class="comment"># $dexec llb1 ip route</span></span><br><span class="line">default via 172.17.0.1 dev eth0</span><br><span class="line">10.10.10.0/24 dev ellb1l3h1 proto kernel scope <span class="built_in">link</span> src 10.10.10.254</span><br><span class="line">31.31.31.0/24 dev ellb1l3ep1 proto kernel scope <span class="built_in">link</span> src 31.31.31.254</span><br><span class="line">32.32.32.0/24 dev ellb1l3ep2 proto kernel scope <span class="built_in">link</span> src 32.32.32.254</span><br><span class="line">33.33.33.0/24 dev ellb1l3ep3 proto kernel scope <span class="built_in">link</span> src 33.33.33.254</span><br><span class="line">45.45.45.0/24 dev ipip0 proto kernel scope <span class="built_in">link</span> src 45.45.45.254</span><br><span class="line">46.46.46.0/24 dev ipip1 proto kernel scope <span class="built_in">link</span> src 46.46.46.254</span><br><span class="line">47.47.47.0/24 dev ipip2 proto kernel scope <span class="built_in">link</span> src 47.47.47.254</span><br><span class="line">56.56.56.0/24 via 45.45.45.1 dev ipip0</span><br><span class="line">57.57.57.0/24 via 46.46.46.1 dev ipip1</span><br><span class="line">58.58.58.0/24 via 47.47.47.1 dev ipip2</span><br><span class="line">172.17.0.0/16 dev eth0 proto kernel scope <span class="built_in">link</span> src 172.17.0.2</span><br><span class="line"></span><br><span class="line"><span class="comment"># $hexec llb1 ip tunnel show</span></span><br><span class="line">tunl0: any/ip remote any <span class="built_in">local</span> any ttl inherit nopmtudisc</span><br><span class="line">ipip0: any/ip remote 31.31.31.1 <span class="built_in">local</span> 31.31.31.254 ttl inherit</span><br><span class="line">ipip1: any/ip remote 32.32.32.1 <span class="built_in">local</span> 32.32.32.254 ttl inherit</span><br><span class="line">ipip2: any/ip remote 33.33.33.1 <span class="built_in">local</span> 33.33.33.254 ttl inherit</span><br></pre></td></tr></table></figure>

<p>查看某个 endpoint 上的配置：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># $dexec l3ep1 ip -br link show</span></span><br><span class="line">lo               UNKNOWN        00:00:00:00:00:00 &lt;LOOPBACK,UP,LOWER_UP&gt;</span><br><span class="line">el3ep1llb1@if4   UP             32:b6:d7:fd:50:de &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt;</span><br><span class="line">tunl0@NONE       DOWN           0.0.0.0 &lt;NOARP&gt;</span><br><span class="line">ipip0@NONE       UNKNOWN        31.31.31.1 &lt;POINTOPOINT,NOARP,UP,LOWER_UP&gt;</span><br><span class="line">eth0@if116       UP             02:42:ac:11:00:04 &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># $dexec l3ep1 ip -br addr show</span></span><br><span class="line">lo               UNKNOWN        127.0.0.1/8 56.56.56.1/32 20.20.20.1/32</span><br><span class="line">el3ep1llb1@if4   UP             31.31.31.1/24</span><br><span class="line">tunl0@NONE       DOWN</span><br><span class="line">ipip0@NONE       UNKNOWN        45.45.45.1/24</span><br><span class="line">eth0@if116       UP             172.17.0.4/16</span><br><span class="line"></span><br><span class="line"><span class="comment"># $dexec l3ep1 ip route</span></span><br><span class="line">default via 31.31.31.254 dev el3ep1llb1</span><br><span class="line">31.31.31.0/24 dev el3ep1llb1 proto kernel scope <span class="built_in">link</span> src 31.31.31.1</span><br><span class="line">45.45.45.0/24 dev ipip0 proto kernel scope <span class="built_in">link</span> src 45.45.45.1</span><br><span class="line">172.17.0.0/16 dev eth0 proto kernel scope <span class="built_in">link</span> src 172.17.0.4</span><br></pre></td></tr></table></figure>

<p>看下抓的报文：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># $hexec llb1 tcpdump -i ellb1l3h1 -n -l</span></span><br><span class="line">tcpdump: verbose output suppressed, use -v[v]... <span class="keyword">for</span> full protocol decode</span><br><span class="line">listening on ellb1l3h1, link-type EN10MB (Ethernet), snapshot length 262144 bytes</span><br><span class="line"><span class="comment"># llb1 上的 ellb1l3h1 收到 SYN 包</span></span><br><span class="line">19:05:10.487705 IP 10.10.10.1.55001 &gt; 20.20.20.1.8080: Flags [S], <span class="built_in">seq</span> 3053784621, win 63680, options [mss 7960,sackOK,TS val 3433925339 ecr 0,nop,wscale 7], length 0</span><br></pre></td></tr></table></figure>

<p>而从 LB <code>ellb1l3ep3</code> 接口上的抓包可以看到，该 SYN 包通过 IPIP 隧道协议发送：</p>
<img src="/fuchencong.github.io/2024/06/27/loxilb-01/images/ipip.jpg" class="">

<h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ul>
<li><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/31265993/docker-networking-namespace-not-visible-in-ip-netns-list">docker networking namespace not visible in ip netns list</a></li>
</ul>

    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/fuchencong.github.io/tags/ebpf/" rel="tag"># ebpf</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/fuchencong.github.io/2024/09/29/improve-go-01/" rel="prev" title="《Go 语言精进之路》读书笔记（01）：熟知 Go 语言的一切">
      <i class="fa fa-chevron-left"></i> 《Go 语言精进之路》读书笔记（01）：熟知 Go 语言的一切
    </a></div>
      <div class="post-nav-item">
    <a href="/fuchencong.github.io/2024/05/15/ebpf-go-01/" rel="next" title="ebpf-go 库学习（1）：ebpf-go 使用入门">
      ebpf-go 库学习（1）：ebpf-go 使用入门 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9E%84%E5%BB%BA-loxilb"><span class="nav-number">1.</span> <span class="nav-text">构建 loxilb</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9B%9B%E5%B1%82-LB-%E5%9F%BA%E7%A1%80%E5%8A%9F%E8%83%BD%E6%B5%8B%E8%AF%95"><span class="nav-number">2.</span> <span class="nav-text">四层 LB 基础功能测试</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%90%AD%E5%BB%BA%E6%B5%8B%E8%AF%95%E7%8E%AF%E5%A2%83"><span class="nav-number">2.1.</span> <span class="nav-text">搭建测试环境</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%BF%90%E8%A1%8C%E6%B5%8B%E8%AF%95"><span class="nav-number">2.2.</span> <span class="nav-text">运行测试</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8A%93%E5%8C%85%E5%88%86%E6%9E%90"><span class="nav-number">2.3.</span> <span class="nav-text">抓包分析</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%A7%BB%E9%99%A4%E6%B5%8B%E8%AF%95%E7%8E%AF%E5%A2%83"><span class="nav-number">2.4.</span> <span class="nav-text">移除测试环境</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%85%B6%E4%BB%96%E6%B5%8B%E8%AF%95"><span class="nav-number">3.</span> <span class="nav-text">其他测试</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#cicd-tcplbdsr1"><span class="nav-number">3.1.</span> <span class="nav-text">cicd&#x2F;tcplbdsr1&#x2F;</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#cicd-tcplbdsr2"><span class="nav-number">3.2.</span> <span class="nav-text">cicd&#x2F;tcplbdsr2&#x2F;</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#cicd-tcplbl3dsr"><span class="nav-number">3.3.</span> <span class="nav-text">cicd&#x2F;tcplbl3dsr&#x2F;</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Reference"><span class="nav-number">4.</span> <span class="nav-text">Reference</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="fuchencong"
      src="/fuchencong.github.io/images/logo.jpeg">
  <p class="site-author-name" itemprop="name">fuchencong</p>
  <div class="site-description" itemprop="description">Having dreams is what makes life tolerable.</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/fuchencong.github.io/archives/">
        
          <span class="site-state-item-count">182</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/fuchencong.github.io/categories/">
          
        <span class="site-state-item-count">15</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/fuchencong.github.io/tags/">
          
        <span class="site-state-item-count">32</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/fuchencong" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;fuchencong" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:fuchencong@163.com" title="E-Mail → mailto:fuchencong@163.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">fuchencong</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/fuchencong.github.io/lib/anime.min.js"></script>
  <script src="/fuchencong.github.io/lib/velocity/velocity.min.js"></script>
  <script src="/fuchencong.github.io/lib/velocity/velocity.ui.min.js"></script>

<script src="/fuchencong.github.io/js/utils.js"></script>

<script src="/fuchencong.github.io/js/motion.js"></script>


<script src="/fuchencong.github.io/js/schemes/muse.js"></script>


<script src="/fuchencong.github.io/js/next-boot.js"></script>




  















  

  

</body>
</html>
