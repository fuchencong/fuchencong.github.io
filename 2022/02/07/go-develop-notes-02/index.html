<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/fuchencong.github.io/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/fuchencong.github.io/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/fuchencong.github.io/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/fuchencong.github.io/images/logo.svg" color="#222">

<link rel="stylesheet" href="/fuchencong.github.io/css/main.css">


<link rel="stylesheet" href="/fuchencong.github.io/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"fuchencong.github.io","root":"/fuchencong.github.io/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"right","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="etcdctl 是一个 etcd 命令行工具，通过它可以与 etcd 集群进行交互。这篇文章总结下 etcdctl 的使用方法。">
<meta property="og:type" content="article">
<meta property="og:title" content="etcdctl 工具总结">
<meta property="og:url" content="https://fuchencong.github.io/fuchencong.github.io/2022/02/07/go-develop-notes-02/index.html">
<meta property="og:site_name" content="fuchencong">
<meta property="og:description" content="etcdctl 是一个 etcd 命令行工具，通过它可以与 etcd 集群进行交互。这篇文章总结下 etcdctl 的使用方法。">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2022-02-07T09:49:19.000Z">
<meta property="article:modified_time" content="2022-08-25T12:04:03.778Z">
<meta property="article:author" content="fuchencong">
<meta property="article:tag" content="etcdctl">
<meta property="article:tag" content="etcd">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://fuchencong.github.io/fuchencong.github.io/2022/02/07/go-develop-notes-02/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>etcdctl 工具总结 | fuchencong</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/fuchencong.github.io/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">fuchencong</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">The way I am</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/fuchencong.github.io/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/fuchencong.github.io/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/fuchencong.github.io/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/fuchencong.github.io/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/fuchencong.github.io/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://fuchencong.github.io/fuchencong.github.io/2022/02/07/go-develop-notes-02/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/fuchencong.github.io/images/logo.jpeg">
      <meta itemprop="name" content="fuchencong">
      <meta itemprop="description" content="Having dreams is what makes life tolerable.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fuchencong">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          etcdctl 工具总结
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-02-07 17:49:19" itemprop="dateCreated datePublished" datetime="2022-02-07T17:49:19+08:00">2022-02-07</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/fuchencong.github.io/categories/%E5%BC%80%E6%BA%90%E5%AD%A6%E4%B9%A0/" itemprop="url" rel="index"><span itemprop="name">开源学习</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>etcdctl 是一个 etcd 命令行工具，通过它可以与 etcd 集群进行交互。这篇文章总结下 etcdctl 的使用方法。</p>
<span id="more"></span>

<h2 id="通用说明"><a href="#通用说明" class="headerlink" title="通用说明"></a>通用说明</h2><ul>
<li>当前 etcdctl 默认使用 v3 API 和 etcd 通信。如果想要使用 v2 API，可以设置环境变量：<code>ETCDCTL_API=2</code>。</li>
<li>所有的命令都可以通过 <code>-w</code> 或 <code>--write-out</code> 选项设置输出格式。支持的输出格式有 <code>simple</code>、<code>json</code>、<code>Protobuf</code>、<code>Fields</code></li>
<li>所有命令默认都是 <code>simple</code> 输出。如果一个命令有对应的 RPC，那么它可以接受所有输出格式</li>
<li>如果命令执行失败，返回非 0 退出码，同时会输出错误字符串信息，此时输出格式不生效</li>
</ul>
<h2 id="Key-value-命令"><a href="#Key-value-命令" class="headerlink" title="Key-value 命令"></a>Key-value 命令</h2><h3 id="设置-key"><a href="#设置-key" class="headerlink" title="设置 key"></a>设置 key</h3><p>命令语法：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PUT [options] &lt;key&gt; &lt;value&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li>为指定 key 设置 value</li>
<li>对应的 RPC: Put</li>
</ul>
<p>通用选项：</p>
<ul>
<li><code>--lease &lt;lease ID&gt;</code>：设置 key 所使用的租约 ID</li>
<li><code>--prev-kv</code>：返回该 key 修改之前的值</li>
<li><code>ignore-value</code>：使用当前值更新 key</li>
<li><code>ignore-lease</code>：使用当前 lease 更新 key</li>
</ul>
<p>示例：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ etcdctl put foo bar</span><br><span class="line">OK</span><br><span class="line">$ etcdctl get foo</span><br><span class="line">foo</span><br><span class="line">bar</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ etcdctl put foo bar1 --prev-kv</span><br><span class="line">OK</span><br><span class="line">foo</span><br><span class="line">bar</span><br><span class="line">$ etcdctl get foo</span><br><span class="line">foo</span><br><span class="line">bar1</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$etcdctl</span> put foo --ignore-value</span><br><span class="line">OK</span><br><span class="line">$ etcdctl get foo</span><br><span class="line">foo</span><br><span class="line">bar1</span><br><span class="line"></span><br><span class="line">$ etcdctl get foo -w fields</span><br><span class="line"><span class="string">&quot;ClusterID&quot;</span> : 10316109323310759371</span><br><span class="line"><span class="string">&quot;MemberID&quot;</span> : 12530464223947363063</span><br><span class="line"><span class="string">&quot;Revision&quot;</span> : 4</span><br><span class="line"><span class="string">&quot;RaftTerm&quot;</span> : 2</span><br><span class="line"><span class="string">&quot;Key&quot;</span> : <span class="string">&quot;foo&quot;</span></span><br><span class="line"><span class="string">&quot;CreateRevision&quot;</span> : 2</span><br><span class="line"><span class="string">&quot;ModRevision&quot;</span> : 4</span><br><span class="line"><span class="string">&quot;Version&quot;</span> : 3</span><br><span class="line"><span class="string">&quot;Value&quot;</span> : <span class="string">&quot;bar1&quot;</span></span><br><span class="line"><span class="string">&quot;Lease&quot;</span> : 0</span><br><span class="line"><span class="string">&quot;More&quot;</span> : <span class="literal">false</span></span><br><span class="line"><span class="string">&quot;Count&quot;</span> : 1</span><br><span class="line"></span><br><span class="line">$ etcdctl put foo --ignore-value</span><br><span class="line">OK</span><br><span class="line"></span><br><span class="line">// 可以看到，虽然值没有变，但是其 ModRevision 发生了改变</span><br><span class="line">$ etcdctl get foo -w fields</span><br><span class="line"><span class="string">&quot;ClusterID&quot;</span> : 10316109323310759371</span><br><span class="line"><span class="string">&quot;MemberID&quot;</span> : 12530464223947363063</span><br><span class="line"><span class="string">&quot;Revision&quot;</span> : 5</span><br><span class="line"><span class="string">&quot;RaftTerm&quot;</span> : 2</span><br><span class="line"><span class="string">&quot;Key&quot;</span> : <span class="string">&quot;foo&quot;</span></span><br><span class="line"><span class="string">&quot;CreateRevision&quot;</span> : 2</span><br><span class="line"><span class="string">&quot;ModRevision&quot;</span> : 5</span><br><span class="line"><span class="string">&quot;Version&quot;</span> : 4</span><br><span class="line"><span class="string">&quot;Value&quot;</span> : <span class="string">&quot;bar1&quot;</span></span><br><span class="line"><span class="string">&quot;Lease&quot;</span> : 0</span><br><span class="line"><span class="string">&quot;More&quot;</span> : <span class="literal">false</span></span><br><span class="line"><span class="string">&quot;Count&quot;</span> : 1</span><br></pre></td></tr></table></figure>

<p>注意事项：</p>
<ul>
<li>如果想在 value 中包含换行符，需要在输入时使用 <code>&quot;&quot;</code> 引用输入的内容。</li>
<li>如果输入 value 中包含 <code>-</code>，可以通过如下形式解决，否则 <code>-value</code> 会被当成命令 flag</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">./etcdctl put &lt;key&gt; -- &lt;value&gt;</span><br><span class="line">./etcdctl put -- &lt;key&gt; &lt;value&gt;</span><br></pre></td></tr></table></figure>

<p>例如：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ etcdctl put foo3 -- -<span class="built_in">test</span></span><br><span class="line">OK</span><br><span class="line">$ etcdctl get foo3</span><br><span class="line">foo3</span><br><span class="line">-<span class="built_in">test</span></span><br></pre></td></tr></table></figure>

<h3 id="获取-key"><a href="#获取-key" class="headerlink" title="获取 key"></a>获取 key</h3><p>命令语法：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET [options] &lt;key&gt; [range_end]</span><br></pre></td></tr></table></figure>

<ul>
<li>用于获取某个 key 或某个 key 范围 [key, range_end)</li>
<li>对应的 RPC：Range</li>
</ul>
<p>常用选项：</p>
<ul>
<li><code>--hex</code>：以十六进制输出 key&#x2F;value</li>
<li><code>--limit &lt;number&gt;</code>：限制输出结果的个数</li>
<li><code>--prefix</code>：通过前缀匹配获取 key</li>
<li><code>--order</code>：对结果排序，ASCEND 或 DESCEND</li>
<li><code>sort-by</code>：设置排序依据，可以是 CREATE、KEY、MODIFY、VALUE 或 VERSION</li>
<li><code>--rev &lt;revision&gt;</code>：指定 KV 版本</li>
<li><code>--print-value-only</code>：只输出值</li>
<li><code>--consistency</code>：一致性，可以是 Linearizable 或 Serializable</li>
<li><code>from-key</code>：获取大于等于指定 key 的所有 key（通过字节比较排序）</li>
<li><code>keys-only</code>：只输出 key</li>
</ul>
<p>示例：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">$ etcdctl get foo</span><br><span class="line">foo</span><br><span class="line">bar1</span><br><span class="line"></span><br><span class="line">$ etcdctl get foo foo2</span><br><span class="line">foo</span><br><span class="line">bar1</span><br><span class="line">foo1</span><br><span class="line">bar1</span><br><span class="line"></span><br><span class="line">$ etcdctl get foo foo2 --<span class="built_in">limit</span> 1</span><br><span class="line">foo</span><br><span class="line">bar1</span><br><span class="line"></span><br><span class="line">$ etcdctl get foo --prefix</span><br><span class="line">foo</span><br><span class="line">bar1</span><br><span class="line">foo1</span><br><span class="line">bar1</span><br><span class="line">foo2</span><br><span class="line">barnew</span><br><span class="line">foo3</span><br><span class="line">-test4</span><br><span class="line"></span><br><span class="line">$ etcdctl get foo foo2 --order DESCEND --sort-by MODIFY</span><br><span class="line">foo1</span><br><span class="line">bar1</span><br><span class="line">foo</span><br><span class="line">bar1</span><br><span class="line"></span><br><span class="line">$ etcdctl get foo foo2 --print-value-only</span><br><span class="line">bar1</span><br><span class="line">bar1</span><br><span class="line"></span><br><span class="line">$ etcdctl get foo --from-key</span><br><span class="line">foo</span><br><span class="line">bar1</span><br><span class="line">foo1</span><br><span class="line">bar1</span><br><span class="line">foo2</span><br><span class="line">barnew</span><br><span class="line">foo3</span><br><span class="line">-test4</span><br><span class="line"></span><br><span class="line">$ etcdctl get foo --from-key --keys-only</span><br><span class="line">foo</span><br><span class="line"></span><br><span class="line">foo1</span><br><span class="line"></span><br><span class="line">foo2</span><br><span class="line"></span><br><span class="line">foo3</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>注意事项：</p>
<ul>
<li>可以通过 <code>etcdctl get --from-key &#39;&#39;</code> 获取所有的 key</li>
<li>当 key 或 value 中有不可打印字符或者控制字符，此时输出可能会引入混淆，为了解决该问题，可以使用 <code>--hex</code> 进行输出</li>
</ul>
<h3 id="删除-key"><a href="#删除-key" class="headerlink" title="删除 key"></a>删除 key</h3><p>命令语法：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DEL [options] &lt;key&gt; [range_end]</span><br></pre></td></tr></table></figure>

<ul>
<li>移除指定的 key 或 key 范围</li>
<li>对应的 RPC 方法：DeleteRange</li>
<li>如果删除成功，返回删除的元素个数</li>
</ul>
<p>常用选项：</p>
<ul>
<li><code>--prefix</code>：通过前缀匹配指定 key</li>
<li><code>--prev-kv</code>：返回删除的 key-value 对</li>
<li><code>--from-key</code>：删除大于等于指定 key 的所有 key（通过字节比较排序）</li>
</ul>
<p>示例：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">$ etcdctl del foo</span><br><span class="line">1</span><br><span class="line">$ etcdctl del foo foo1</span><br><span class="line">0</span><br><span class="line">$ etcdctl del foo foo2</span><br><span class="line">1</span><br><span class="line">$ etcdctl del foo2 --prev-kv</span><br><span class="line">1</span><br><span class="line">foo2</span><br><span class="line">barnew</span><br><span class="line">$ etcdctl del foo2 --from-key</span><br><span class="line">1</span><br><span class="line">$ etcdctl del foo2 --prefix</span><br><span class="line">0</span><br></pre></td></tr></table></figure>

<h3 id="事务"><a href="#事务" class="headerlink" title="事务"></a>事务</h3><p>命令语法：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">TXN [options]</span><br></pre></td></tr></table></figure>

<ul>
<li>TXN 从标准输入中读取多个请求，并将它们应用到单个原子的事务操作中。一个事务包含 <code>一系列的条件</code>、<code>所有条件都满足时要执行的一系列请求</code>、<code>任意条件不满足时要执行的一系列请求</code></li>
<li>对应的 RPC：Txn</li>
</ul>
<p>TXN 的语法为：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;Txn&gt; ::= &lt;CMP&gt;* <span class="string">&quot;\n&quot;</span> &lt;THEN&gt; <span class="string">&quot;\n&quot;</span> &lt;ELSE&gt; <span class="string">&quot;\n&quot;</span></span><br><span class="line">&lt;CMP&gt; ::= (&lt;CMPCREATE&gt;|&lt;CMPMOD&gt;|&lt;CMPVAL&gt;|&lt;CMPVER&gt;|&lt;CMPLEASE&gt;) <span class="string">&quot;\n&quot;</span></span><br><span class="line">&lt;CMPOP&gt; ::= <span class="string">&quot;&lt;&quot;</span> | <span class="string">&quot;=&quot;</span> | <span class="string">&quot;&gt;&quot;</span></span><br><span class="line">&lt;CMPCREATE&gt; := (<span class="string">&quot;c&quot;</span>|<span class="string">&quot;create&quot;</span>)<span class="string">&quot;(&quot;</span>&lt;KEY&gt;<span class="string">&quot;)&quot;</span> &lt;CMPOP&gt; &lt;REVISION&gt;</span><br><span class="line">&lt;CMPMOD&gt; ::= (<span class="string">&quot;m&quot;</span>|<span class="string">&quot;mod&quot;</span>)<span class="string">&quot;(&quot;</span>&lt;KEY&gt;<span class="string">&quot;)&quot;</span> &lt;CMPOP&gt; &lt;REVISION&gt;</span><br><span class="line">&lt;CMPVAL&gt; ::= (<span class="string">&quot;val&quot;</span>|<span class="string">&quot;value&quot;</span>)<span class="string">&quot;(&quot;</span>&lt;KEY&gt;<span class="string">&quot;)&quot;</span> &lt;CMPOP&gt; &lt;VALUE&gt;</span><br><span class="line">&lt;CMPVER&gt; ::= (<span class="string">&quot;ver&quot;</span>|<span class="string">&quot;version&quot;</span>)<span class="string">&quot;(&quot;</span>&lt;KEY&gt;<span class="string">&quot;)&quot;</span> &lt;CMPOP&gt; &lt;VERSION&gt;</span><br><span class="line">&lt;CMPLEASE&gt; ::= <span class="string">&quot;lease(&quot;</span>&lt;KEY&gt;<span class="string">&quot;)&quot;</span> &lt;CMPOP&gt; &lt;LEASE&gt;</span><br><span class="line">&lt;THEN&gt; ::= &lt;OP&gt;*</span><br><span class="line">&lt;ELSE&gt; ::= &lt;OP&gt;*</span><br><span class="line">&lt;OP&gt; ::= ((see put, get, del etcdctl <span class="built_in">command</span> syntax)) <span class="string">&quot;\n&quot;</span></span><br><span class="line">&lt;KEY&gt; ::= (%q formatted string)</span><br><span class="line">&lt;VALUE&gt; ::= (%q formatted string)</span><br><span class="line">&lt;REVISION&gt; ::= <span class="string">&quot;\&quot;&quot;</span>[0-9]+<span class="string">&quot;\&quot;&quot;</span></span><br><span class="line">&lt;VERSION&gt; ::= <span class="string">&quot;\&quot;&quot;</span>[0-9]+<span class="string">&quot;\&quot;&quot;</span></span><br><span class="line">&lt;LEASE&gt; ::= <span class="string">&quot;\&quot;&quot;</span>[0-9]+\&quot;<span class="string">&quot;</span></span><br></pre></td></tr></table></figure>

<p>如果执行的是事务成功条件下的命令列表，输出 <code>SUCCESS</code>，否则输出 <code>FAILURE</code>。同时会输出命令列表中的每个命令的结果，以空行分隔。</p>
<p>常用选项：</p>
<ul>
<li><code>--hex</code>：以十六进制输出 key 和 value</li>
<li><code>--interactive</code>：以交互模式执行 <code>input transaction</code></li>
</ul>
<p>示例：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">$ etcdctl txn -i</span><br><span class="line">compares:</span><br><span class="line">mod(<span class="string">&quot;key1&quot;</span>) &gt; <span class="string">&quot;0&quot;</span></span><br><span class="line"></span><br><span class="line">success requests (get, put, del):</span><br><span class="line">put key1 <span class="string">&quot;overwrote-key1&quot;</span></span><br><span class="line"></span><br><span class="line">failure requests (get, put, del):</span><br><span class="line">put key1 <span class="string">&quot;created-key1&quot;</span></span><br><span class="line">put key2 <span class="string">&quot;some extra key&quot;</span></span><br><span class="line"></span><br><span class="line">FAILURE</span><br><span class="line"></span><br><span class="line">OK</span><br><span class="line"></span><br><span class="line">OK</span><br><span class="line">$ etcdctl get key1</span><br><span class="line">key1</span><br><span class="line">created-key1</span><br><span class="line">$ etcdctl get key2</span><br><span class="line">key2</span><br><span class="line">some extra key</span><br></pre></td></tr></table></figure>

<p>注意事项：</p>
<ul>
<li>由于在 TXN 中通过换行符来分隔事务命令，因此如果 TXN 命令中如果本身需要输入换行符，则必须使用 <code>\n</code>。</li>
</ul>
<h3 id="压缩"><a href="#压缩" class="headerlink" title="压缩"></a>压缩</h3><p>命令语法：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">COMPACTION [options] &lt;revision&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li>compaction 命令用于丢弃给定 revision 之前的所有 etcd 事件历史。由于 etcd 使用多版本并发控制模型，它会以事件历史的形式保存所有的 key 更新记录。当给定 revision 之前的事件历史不再需要时候，此时可以对 key 进行压缩以释放 etcd 后端数据存储空间</li>
<li>对应的 RPC 方法：Compact</li>
</ul>
<p>常用选项：</p>
<ul>
<li><code>--physical</code>：等待 compaction 操作物理移除所有旧的 revisions</li>
</ul>
<p>示例：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">$ etcdctl put key value1 -w fields</span><br><span class="line"><span class="string">&quot;ClusterID&quot;</span> : 10316109323310759371</span><br><span class="line"><span class="string">&quot;MemberID&quot;</span> : 12530464223947363063</span><br><span class="line"><span class="string">&quot;Revision&quot;</span> : 21</span><br><span class="line"><span class="string">&quot;RaftTerm&quot;</span> : 2</span><br><span class="line"></span><br><span class="line">$ etcdctl put key value2 -w fields</span><br><span class="line"><span class="string">&quot;ClusterID&quot;</span> : 10316109323310759371</span><br><span class="line"><span class="string">&quot;MemberID&quot;</span> : 12530464223947363063</span><br><span class="line"><span class="string">&quot;Revision&quot;</span> : 22</span><br><span class="line"><span class="string">&quot;RaftTerm&quot;</span> : 2</span><br><span class="line"></span><br><span class="line">$ etcdctl compact 22</span><br><span class="line">compacted revision 22</span><br><span class="line">I have no name!@9008eb121933:/opt/bitnami/etcd$ etcdctl get key</span><br><span class="line">key</span><br><span class="line">value2</span><br><span class="line"></span><br><span class="line">$ etcdctl get key --rev 22</span><br><span class="line">key</span><br><span class="line">value2</span><br><span class="line"></span><br><span class="line">$ etcdctl get key --rev 21</span><br><span class="line">&#123;<span class="string">&quot;level&quot;</span>:<span class="string">&quot;warn&quot;</span>,<span class="string">&quot;ts&quot;</span>:<span class="string">&quot;2022-02-23T11:34:26.239Z&quot;</span>,<span class="string">&quot;logger&quot;</span>:<span class="string">&quot;etcd-client&quot;</span>,<span class="string">&quot;caller&quot;</span>:<span class="string">&quot;v3/retry_interceptor.go:62&quot;</span>,<span class="string">&quot;msg&quot;</span>:<span class="string">&quot;retrying of unary invoker failed&quot;</span>,<span class="string">&quot;target&quot;</span>:<span class="string">&quot;etcd-endpoints://0xc00023e000/127.0.0.1:2379&quot;</span>,<span class="string">&quot;attempt&quot;</span>:0,<span class="string">&quot;error&quot;</span>:<span class="string">&quot;rpc error: code = OutOfRange desc = etcdserver: mvcc: required revision has been compacted&quot;</span>&#125;</span><br><span class="line">Error: etcdserver: mvcc: required revision has been compacted</span><br></pre></td></tr></table></figure>

<h3 id="WATCH"><a href="#WATCH" class="headerlink" title="WATCH"></a>WATCH</h3><p>命令语法：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">WATCH [options] [key or prefix] [range_end] [--] [exec-command arg1 arg2 ...]</span><br></pre></td></tr></table></figure>

<ul>
<li>通过 <code>Watch</code> 命令可以监控指定 key、前缀、key 范围的事件流。<code>watch</code> 命令会持续运行，直到出现错误或终端用户手动终止</li>
<li>对应的 RPC 方法：Watch</li>
<li>输出的格式为：</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;event&gt;[\n&lt;old_key&gt;\n&lt;old_value&gt;]\n&lt;key&gt;\n&lt;value&gt;\n&lt;event&gt;\n&lt;next_key&gt;\n&lt;next_value&gt;\n...</span><br></pre></td></tr></table></figure>

<p>常用选项：</p>
<ul>
<li><code>--hex</code>：以十六进制输出 key 和 value</li>
<li><code>--interactive</code>：开始交互式的 watch</li>
<li><code>--prefix</code>：按前缀进行 watch</li>
<li><code>--prev-kv</code>：输出之前的 key-value 值</li>
<li><code>--rev</code>：从指定的 revision 开始 watch，这可以使得我们获得之间的事件</li>
</ul>
<p>示例：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ etcdctl watch foo</span><br><span class="line"></span><br><span class="line">$ etcdctl put foo bar</span><br><span class="line">OK</span><br><span class="line"></span><br><span class="line">$ etcdctl watch foo</span><br><span class="line">PUT</span><br><span class="line">foo</span><br><span class="line">bar</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ etcdctl put foo bar2</span><br><span class="line"></span><br><span class="line">$ etcdctl watch foo --prev-kv</span><br><span class="line">PUT</span><br><span class="line">foo</span><br><span class="line">bar</span><br><span class="line">foo</span><br><span class="line">bar2</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">$ etcdctl put foo bar3</span><br><span class="line">OK</span><br><span class="line">$ etcdctl put foo3 bar3</span><br><span class="line">OK</span><br><span class="line">$ etcdctl put foo1 bar1</span><br><span class="line">OK</span><br><span class="line"></span><br><span class="line">$ etcdctl watch foo foo2</span><br><span class="line">PUT</span><br><span class="line">foo</span><br><span class="line">bar3</span><br><span class="line">PUT</span><br><span class="line">foo1</span><br><span class="line">bar1</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">$ etcdctl put foo bar4 -w fields</span><br><span class="line"><span class="string">&quot;ClusterID&quot;</span> : 10316109323310759371</span><br><span class="line"><span class="string">&quot;MemberID&quot;</span> : 15168875803774599630</span><br><span class="line"><span class="string">&quot;Revision&quot;</span> : 33</span><br><span class="line"><span class="string">&quot;RaftTerm&quot;</span> : 2</span><br><span class="line">$ etcdctl put foo bar5 -w fields</span><br><span class="line"><span class="string">&quot;ClusterID&quot;</span> : 10316109323310759371</span><br><span class="line"><span class="string">&quot;MemberID&quot;</span> : 15168875803774599630</span><br><span class="line"><span class="string">&quot;Revision&quot;</span> : 34</span><br><span class="line"><span class="string">&quot;RaftTerm&quot;</span> : 2</span><br><span class="line">$ etcdctl put foo bar6 -w fields</span><br><span class="line"><span class="string">&quot;ClusterID&quot;</span> : 10316109323310759371</span><br><span class="line"><span class="string">&quot;MemberID&quot;</span> : 15168875803774599630</span><br><span class="line"><span class="string">&quot;Revision&quot;</span> : 35</span><br><span class="line"><span class="string">&quot;RaftTerm&quot;</span> : 2</span><br><span class="line"></span><br><span class="line">$ etcdctl watch foo --rev 34</span><br><span class="line">PUT</span><br><span class="line">foo</span><br><span class="line">bar5</span><br><span class="line">PUT</span><br><span class="line">foo</span><br><span class="line">bar6</span><br><span class="line"></span><br><span class="line">$ etcdctl watch foo --rev 35</span><br><span class="line">PUT</span><br><span class="line">foo</span><br><span class="line">bar6</span><br></pre></td></tr></table></figure>

<p>如果想在收到事件后执行命令，可以通过 <code>[--] [exec-command arg1 arg2 ...]</code> 的方式指定，例如在收到事件后，执行 <code>echo watch event received</code>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ etcdctl watch foo -- <span class="built_in">echo</span> watch event received</span><br><span class="line"></span><br><span class="line">$ etcdctl put foo bar</span><br><span class="line">OK</span><br><span class="line"></span><br><span class="line">$ etcdctl watch foo -- <span class="built_in">echo</span> watch event received</span><br><span class="line">PUT</span><br><span class="line">foo</span><br><span class="line">bar</span><br><span class="line">watch event received</span><br></pre></td></tr></table></figure>

<p>watch 的响应会通过环境变量 <code>ETCD_WATCH_*</code> 设置：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">$ etcdctl put foo bar</span><br><span class="line"></span><br><span class="line">$ etcdctl watch foo -- sh -c <span class="string">&quot;env | grep ETCD_WATCH_&quot;</span></span><br><span class="line">PUT</span><br><span class="line">foo</span><br><span class="line">bar</span><br><span class="line">ETCD_WATCH_REVISION=25</span><br><span class="line">ETCD_WATCH_KEY=<span class="string">&quot;foo&quot;</span></span><br><span class="line">ETCD_WATCH_EVENT_TYPE=<span class="string">&quot;PUT&quot;</span></span><br><span class="line">ETCD_WATCH_VALUE=<span class="string">&quot;bar&quot;</span></span><br><span class="line">DELETE</span><br><span class="line">foo</span><br><span class="line"></span><br><span class="line">$ etcdctl del foo</span><br><span class="line">ETCD_WATCH_REVISION=26</span><br><span class="line">ETCD_WATCH_KEY=<span class="string">&quot;foo&quot;</span></span><br><span class="line">ETCD_WATCH_EVENT_TYPE=<span class="string">&quot;DELETE&quot;</span></span><br><span class="line">ETCD_WATCH_VALUE=<span class="string">&quot;&quot;</span></span><br></pre></td></tr></table></figure>

<h3 id="租约"><a href="#租约" class="headerlink" title="租约"></a>租约</h3><h4 id="创建租约"><a href="#创建租约" class="headerlink" title="创建租约"></a>创建租约</h4><p>命令语法：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LEASE GRANT &lt;ttl&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li>新建一个租约，租约的到期时间为 <code>ttl</code> 秒</li>
<li>对应的 RPC：LeaseGrant</li>
<li>输出创建的租约 ID</li>
</ul>
<p>示例：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ etcdctl lease grant 20</span><br><span class="line">lease 12f77f2076d86f50 granted with TTL(20s)</span><br><span class="line">$ etcdctl put foo bar --lease 12f77f2076d86f50</span><br><span class="line">OK</span><br><span class="line">$ etcdctl get foo</span><br><span class="line">foo</span><br><span class="line">bar</span><br><span class="line">$ etcdctl get foo</span><br></pre></td></tr></table></figure>

<h4 id="释放租约"><a href="#释放租约" class="headerlink" title="释放租约"></a>释放租约</h4><p>命令语法：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LEASE REVOKE &lt;leaseID&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li>释放一个指定的租约，并删除该租约关联的所有 keys</li>
<li>对应的 RPC：LeaseRevoke</li>
</ul>
<p>示例：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ etcdctl lease grant 600</span><br><span class="line">lease 12f77f2076d86f60 granted with TTL(600s)</span><br><span class="line">$ etcdctl put foo bar --lease 12f77f2076d86f60</span><br><span class="line">OK</span><br><span class="line">$ etcdctl get foo</span><br><span class="line">foo</span><br><span class="line">bar</span><br><span class="line">$ etcdctl lease revoke 12f77f2076d86f60</span><br><span class="line">lease 12f77f2076d86f60 revoked</span><br><span class="line">$ etcdctl get foo</span><br></pre></td></tr></table></figure>

<h4 id="获取租约"><a href="#获取租约" class="headerlink" title="获取租约"></a>获取租约</h4><p>命令语法：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LEASE TIMETOLIVE &lt;leaseID&gt; [options]</span><br></pre></td></tr></table></figure>

<ul>
<li>获取指定租约的信息</li>
<li>对应的 RPC 方法：LeaseTimeToLive</li>
</ul>
<p>常用选项：</p>
<ul>
<li><code>--keys</code>：获取该租约上附加的 keys</li>
</ul>
<p>示例：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ etcdctl lease grant 600</span><br><span class="line">lease 12f77f2076d86f66 granted with TTL(600s)</span><br><span class="line">$ etcdctl put foo bar --lease 12f77f2076d86f66</span><br><span class="line">OK</span><br><span class="line">$ etcdctl lease timetolive 12f77f2076d86f66</span><br><span class="line">lease 12f77f2076d86f66 granted with TTL(600s), remaining(572s)</span><br><span class="line">$ etcdctl lease timetolive 12f77f2076d86f66 --keys</span><br><span class="line">lease 12f77f2076d86f66 granted with TTL(600s), remaining(566s), attached keys([foo])</span><br><span class="line">$ etcdctl put foo1 bar1 --lease 12f77f2076d86f66</span><br><span class="line">$ etcdctl lease timetolive 12f77f2076d86f66 --keys</span><br><span class="line">lease 12f77f2076d86f66 granted with TTL(600s), remaining(462s), attached keys([foo foo1])</span><br></pre></td></tr></table></figure>

<h4 id="获取租约列表"><a href="#获取租约列表" class="headerlink" title="获取租约列表"></a>获取租约列表</h4><p>命令语法：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LEASE LIST</span><br></pre></td></tr></table></figure>

<ul>
<li>列出所有的 lease</li>
<li>对应的 RPC 方法：LeaseLeases</li>
</ul>
<p>示例：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ etcdctl lease list</span><br><span class="line">found 1 leases</span><br><span class="line">12f77f2076d86f66</span><br></pre></td></tr></table></figure>

<h4 id="续约"><a href="#续约" class="headerlink" title="续约"></a>续约</h4><p>命令语法：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LEASE KEEP-ALIVE &lt;leaseID&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li>LEASE KEEP-ALIVE 周期性地对指定租约进行续约，因此该 lease 不会过期</li>
</ul>
<p>示例：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ etcdctl lease timetolive 12f77f2076d86f66</span><br><span class="line">lease 12f77f2076d86f66 granted with TTL(600s), remaining(234s)</span><br><span class="line"></span><br><span class="line">$ etcdctl lease keep-alive 12f77f2076d86f66</span><br><span class="line">lease 12f77f2076d86f66 keepalived with TTL(600)</span><br><span class="line"></span><br><span class="line">$ etcdctl lease timetolive 12f77f2076d86f66</span><br><span class="line">lease 12f77f2076d86f66 granted with TTL(600s), remaining(556s)</span><br></pre></td></tr></table></figure>

<h2 id="集群维护命令"><a href="#集群维护命令" class="headerlink" title="集群维护命令"></a>集群维护命令</h2><h3 id="成员管理"><a href="#成员管理" class="headerlink" title="成员管理"></a>成员管理</h3><p>成员管理命令用于管理 etcd 集群中的成员关系。</p>
<h4 id="添加成员"><a href="#添加成员" class="headerlink" title="添加成员"></a>添加成员</h4><p>命令语法：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">MEMBER ADD &lt;memberName&gt; [options]</span><br></pre></td></tr></table></figure>

<ul>
<li>在 etcd 集群中新添加一个成员</li>
<li>输出新成员的成员 ID 以及其所在的 cluster ID</li>
<li>对应的 RPC 方法：MemberAdd</li>
</ul>
<p>常用选项：</p>
<ul>
<li><code>peer-urls</code>：新成员所关联的 <code>peer-urls</code>，如果包含多个 URL，需要用逗号分隔</li>
</ul>
<p>示例：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ etcdctl member add newMember --peer-urls=https://etcd4:2380</span><br><span class="line">Member 2833744901904773 added to cluster 8f2a2ec5c0087dcb</span><br><span class="line"></span><br><span class="line">ETCD_NAME=<span class="string">&quot;newMember&quot;</span></span><br><span class="line">ETCD_INITIAL_CLUSTER=<span class="string">&quot;newMember=https://etcd4:2380,etcd1=http://etcd1:2380,etcd3=http://etcd3:2380,etcd2=http://etcd2:2380&quot;</span></span><br><span class="line">ETCD_INITIAL_ADVERTISE_PEER_URLS=<span class="string">&quot;https://etcd4:2380&quot;</span></span><br><span class="line">ETCD_INITIAL_CLUSTER_STATE=<span class="string">&quot;existing&quot;</span></span><br></pre></td></tr></table></figure>

<h4 id="更新成员"><a href="#更新成员" class="headerlink" title="更新成员"></a>更新成员</h4><p>命令语法：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">MEMBER UPDATE &lt;memberID&gt; [options]</span><br></pre></td></tr></table></figure>

<ul>
<li>对 etcd 集群中的 member 进行更新，只能更新 <code>peer URLs</code></li>
<li>输出更新的成员 ID 以及其所在的 cluster ID</li>
<li>对应的 RPC 方法：MemberUpdate</li>
</ul>
<p>常用选项：</p>
<ul>
<li><code>--peer-urls</code>：成员所关联的 <code>peer-urls</code>，如果包含多个 URL，需要用逗号分隔</li>
</ul>
<p>示例：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ etcdctl member update 2833744901904773 --peer-urls=https://etcd4:2380</span><br><span class="line">Member 2833744901904773 updated <span class="keyword">in</span> cluster 8f2a2ec5c0087dcb</span><br></pre></td></tr></table></figure>

<h4 id="移除成员"><a href="#移除成员" class="headerlink" title="移除成员"></a>移除成员</h4><p>命令语法：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">MEMBER REMOVE &lt;memberID&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li>从 etcd 集群中移除成员</li>
<li>输出删除的成员 ID 以及其所在的 cluster ID。</li>
<li>对应的 RPC 方法：MEMBER REMOVE <memberID></li>
</ul>
<p>示例：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ etcdctl member remove 2833744901904773</span><br><span class="line">Member 2833744901904773 removed from cluster 8f2a2ec5c0087dcb</span><br></pre></td></tr></table></figure>

<h4 id="列出成员"><a href="#列出成员" class="headerlink" title="列出成员"></a>列出成员</h4><p>命令语法：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">MEMBER LIST</span><br></pre></td></tr></table></figure>

<ul>
<li>显示 etcd 集群中的成员列表</li>
</ul>
<p>示例：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ etcdctl member list</span><br><span class="line">ade526d28b1f92f7, started, etcd1, http://etcd1:2380, http://etcd1:2379, <span class="literal">false</span></span><br><span class="line">bd388e7810915853, started, etcd3, http://etcd3:2380, http://etcd3:2379, <span class="literal">false</span></span><br><span class="line">d282ac2ce600c1ce, started, etcd2, http://etcd2:2380, http://etcd2:2379, <span class="literal">false</span></span><br></pre></td></tr></table></figure>

<h3 id="ENDPOINT-命令"><a href="#ENDPOINT-命令" class="headerlink" title="ENDPOINT 命令"></a>ENDPOINT 命令</h3><p><code>ENDPOINT</code> 命令用于查询独立的 endpoints。</p>
<h4 id="节点健康信息"><a href="#节点健康信息" class="headerlink" title="节点健康信息"></a>节点健康信息</h4><p>命令语法：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ENDPOINT HEALTH</span><br></pre></td></tr></table></figure>

<ul>
<li>用于检查 cluster 集群中 <code>endpoint</code> 列表的健康情况。如果某个 endpoint 无法与集群的其他节点达成一致，就认为该节点是不健康的</li>
</ul>
<p>常用选项：</p>
<ul>
<li><code>--cluster</code>：使用 etcd 集群中的所有成员</li>
</ul>
<p>示例：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 检查默认节点的健康状况</span></span><br><span class="line">$ etcdctl endpoint health</span><br><span class="line">127.0.0.1:2379 is healthy: successfully committed proposal: took = 8.8908ms</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 检查集群所有节点的健康状况</span></span><br><span class="line">$ etcdctl endpoint --cluster health</span><br><span class="line">http://etcd2:2379 is healthy: successfully committed proposal: took = 9.1295ms</span><br><span class="line">http://etcd3:2379 is healthy: successfully committed proposal: took = 8.031ms</span><br><span class="line">http://etcd1:2379 is healthy: successfully committed proposal: took = 25.7359ms</span><br></pre></td></tr></table></figure>

<h4 id="节点状态"><a href="#节点状态" class="headerlink" title="节点状态"></a>节点状态</h4><p>命令语法：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ENDPOINT STATUS</span><br></pre></td></tr></table></figure>

<ul>
<li><code>ENDPOINT STATUS</code> 用来查询给定 <code>endpoint</code> 列表中每个 endpoint 的状态。</li>
</ul>
<p>示例：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ etcdctl endpoint status</span><br><span class="line">127.0.0.1:2379, ade526d28b1f92f7, 3.5.2, 25 kB, <span class="literal">false</span>, <span class="literal">false</span>, 2, 85, 85,</span><br><span class="line"></span><br><span class="line">$ etcdctl endpoint status --cluster</span><br><span class="line">http://etcd1:2379, ade526d28b1f92f7, 3.5.2, 25 kB, <span class="literal">false</span>, <span class="literal">false</span>, 2, 85, 85,</span><br><span class="line">http://etcd3:2379, bd388e7810915853, 3.5.2, 25 kB, <span class="literal">true</span>, <span class="literal">false</span>, 2, 85, 85,</span><br><span class="line">http://etcd2:2379, d282ac2ce600c1ce, 3.5.2, 25 kB, <span class="literal">false</span>, <span class="literal">false</span>, 2, 85, 85,</span><br></pre></td></tr></table></figure>

<h4 id="节点-HASHKV"><a href="#节点-HASHKV" class="headerlink" title="节点 HASHKV"></a>节点 HASHKV</h4><p>命令语法：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ENDPOINT HASHKV</span><br></pre></td></tr></table></figure>

<ul>
<li><code>ENDPOINT HASHKV</code> 用于获取某个 endpoint KV 存储的 hash 值</li>
</ul>
<p>示例：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ etcdctl endpoint hashkv</span><br><span class="line">127.0.0.1:2379, 2755762864</span><br><span class="line"></span><br><span class="line">$ etcdctl endpoint hashkv --cluster</span><br><span class="line">http://etcd1:2379, 2755762864</span><br><span class="line">http://etcd3:2379, 2755762864</span><br><span class="line">http://etcd2:2379, 2755762864</span><br></pre></td></tr></table></figure>

<h3 id="ALARM-命令"><a href="#ALARM-命令" class="headerlink" title="ALARM 命令"></a>ALARM 命令</h3><p>提供告警相关的命令。</p>
<h4 id="解除警告"><a href="#解除警告" class="headerlink" title="解除警告"></a>解除警告</h4><p>命令语法：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ALARM DISARM</span><br></pre></td></tr></table></figure>

<ul>
<li>解除所有的告警</li>
<li>对应的 RPC 方法： Alarm</li>
</ul>
<p>示例：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ etcdctl alarm disarm</span><br></pre></td></tr></table></figure>

<h4 id="列出警告"><a href="#列出警告" class="headerlink" title="列出警告"></a>列出警告</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ALARM LIST</span><br></pre></td></tr></table></figure>

<ul>
<li>列出所有的告警</li>
<li>对应的 RPC 方法为 Alarm</li>
</ul>
<p>示例：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ etcdctl alarm list</span><br></pre></td></tr></table></figure>

<h3 id="碎片整理"><a href="#碎片整理" class="headerlink" title="碎片整理"></a>碎片整理</h3><p>DEFRAG 命令可以在 etcd 运行时为一系列 endpoint 整理后端数据库文件的碎片。当 etcd member 删除或压缩 keys 时，这些 keys 占用的空间仍然会被占用。通过对数据库进行碎片整理，etcd 成员可以把这些空间归还给文件系统。</p>
<p>需要注意，在某个成员上进行在线的碎片整理会阻塞系统的读写。碎片整理操作默认不会在集群中传播，它只会应用于 local node。可以通过 <code>--endpoints</code> 指定集群成员，或者使用 <code>--cluster</code> 标志来指定所有集群成员。</p>
<p>如果想使用离线碎片整理（–data-dir flag），可以使用 <code>etcutl defrag</code>。</p>
<p>示例：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">etcdctl --endpoints=localhost:2379,badendpoint:2379 defrag</span><br><span class="line">Finished defragmenting etcd member[localhost:2379]</span><br><span class="line">&#123;<span class="string">&quot;level&quot;</span>:<span class="string">&quot;warn&quot;</span>,<span class="string">&quot;ts&quot;</span>:<span class="string">&quot;2022-02-24T12:05:08.985Z&quot;</span>,<span class="string">&quot;logger&quot;</span>:<span class="string">&quot;etcd-client&quot;</span>,<span class="string">&quot;caller&quot;</span>:<span class="string">&quot;v3/retry_interceptor.go:62&quot;</span>,<span class="string">&quot;msg&quot;</span>:<span class="string">&quot;retrying of unary invoker failed&quot;</span>,<span class="string">&quot;target&quot;</span>:<span class="string">&quot;etcd-endpoints://0xc00020e000/localhost:2379&quot;</span>,<span class="string">&quot;attempt&quot;</span>:0,<span class="string">&quot;error&quot;</span>:<span class="string">&quot;rpc error: code = DeadlineExceeded desc = latest balancer error: last connection error: connection error: desc = \&quot;transport: Error while dialing dial tcp: lookup badendpoint on 127.0.0.11:53: no such host\&quot;&quot;</span>&#125;</span><br><span class="line">Failed to defragment etcd member[badendpoint:2379] (context deadline exceeded)</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ etcdctl defrag --cluster</span><br><span class="line">Finished defragmenting etcd member[http://etcd1:2379]</span><br><span class="line">Finished defragmenting etcd member[http://etcd3:2379]</span><br><span class="line">Finished defragmenting etcd member[http://etcd2:2379]</span><br></pre></td></tr></table></figure>

<p>如果想直接压缩某个数据目录，可以使用 <code>etcdutl</code> 并指定 <code>--data-dir</code>（该标志马上将被删除）。</p>
<h3 id="快照命令"><a href="#快照命令" class="headerlink" title="快照命令"></a>快照命令</h3><p>SNAPSHOT 命令可以用于实现快照。</p>
<h4 id="保存快照"><a href="#保存快照" class="headerlink" title="保存快照"></a>保存快照</h4><p>命令语法：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SNAPSHOT SAVE &lt;filename&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li>将 etcd 后端数据库实时的数据写入一个文件</li>
</ul>
<p>示例：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">etcdctl snapshot save test.db</span><br><span class="line">&#123;<span class="string">&quot;level&quot;</span>:<span class="string">&quot;info&quot;</span>,<span class="string">&quot;ts&quot;</span>:1645705033.3974695,<span class="string">&quot;caller&quot;</span>:<span class="string">&quot;snapshot/v3_snapshot.go:68&quot;</span>,<span class="string">&quot;msg&quot;</span>:<span class="string">&quot;created temporary db file&quot;</span>,<span class="string">&quot;path&quot;</span>:<span class="string">&quot;test.db.part&quot;</span>&#125;</span><br><span class="line">&#123;<span class="string">&quot;level&quot;</span>:<span class="string">&quot;info&quot;</span>,<span class="string">&quot;ts&quot;</span>:1645705033.4031475,<span class="string">&quot;logger&quot;</span>:<span class="string">&quot;client&quot;</span>,<span class="string">&quot;caller&quot;</span>:<span class="string">&quot;v3/maintenance.go:211&quot;</span>,<span class="string">&quot;msg&quot;</span>:<span class="string">&quot;opened snapshot stream; downloading&quot;</span>&#125;</span><br><span class="line">&#123;<span class="string">&quot;level&quot;</span>:<span class="string">&quot;info&quot;</span>,<span class="string">&quot;ts&quot;</span>:1645705033.403688,<span class="string">&quot;caller&quot;</span>:<span class="string">&quot;snapshot/v3_snapshot.go:76&quot;</span>,<span class="string">&quot;msg&quot;</span>:<span class="string">&quot;fetching snapshot&quot;</span>,<span class="string">&quot;endpoint&quot;</span>:<span class="string">&quot;127.0.0.1:2379&quot;</span>&#125;</span><br><span class="line">&#123;<span class="string">&quot;level&quot;</span>:<span class="string">&quot;info&quot;</span>,<span class="string">&quot;ts&quot;</span>:1645705033.4247742,<span class="string">&quot;logger&quot;</span>:<span class="string">&quot;client&quot;</span>,<span class="string">&quot;caller&quot;</span>:<span class="string">&quot;v3/maintenance.go:219&quot;</span>,<span class="string">&quot;msg&quot;</span>:<span class="string">&quot;completed snapshot read; closing&quot;</span>&#125;</span><br><span class="line">&#123;<span class="string">&quot;level&quot;</span>:<span class="string">&quot;info&quot;</span>,<span class="string">&quot;ts&quot;</span>:1645705033.428916,<span class="string">&quot;caller&quot;</span>:<span class="string">&quot;snapshot/v3_snapshot.go:91&quot;</span>,<span class="string">&quot;msg&quot;</span>:<span class="string">&quot;fetched snapshot&quot;</span>,<span class="string">&quot;endpoint&quot;</span>:<span class="string">&quot;127.0.0.1:2379&quot;</span>,<span class="string">&quot;size&quot;</span>:<span class="string">&quot;25 kB&quot;</span>,<span class="string">&quot;took&quot;</span>:<span class="string">&quot;now&quot;</span>&#125;</span><br><span class="line">&#123;<span class="string">&quot;level&quot;</span>:<span class="string">&quot;info&quot;</span>,<span class="string">&quot;ts&quot;</span>:1645705033.4335535,<span class="string">&quot;caller&quot;</span>:<span class="string">&quot;snapshot/v3_snapshot.go:100&quot;</span>,<span class="string">&quot;msg&quot;</span>:<span class="string">&quot;saved&quot;</span>,<span class="string">&quot;path&quot;</span>:<span class="string">&quot;test.db&quot;</span>&#125;</span><br><span class="line">Snapshot saved at test.db</span><br></pre></td></tr></table></figure>

<h4 id="恢复快照"><a href="#恢复快照" class="headerlink" title="恢复快照"></a>恢复快照</h4><p>命令语法：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SNAPSHOT RESTORE [options] &lt;filename&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li>它根据后端数据库快照以及新的集群配置，为 etcd 集群成员创建一个 etcd 数据目录。为新集群中的每个 member 恢复 snapshot，这样新的 etcd 集群就预先加载了快照数据</li>
<li>该命令即将被遗弃，应该使用 <code>etcdutl snapshot restore</code></li>
</ul>
<p>该命令支持的选项基本类似于 etcd 集群命令：</p>
<ul>
<li><code>--data-dir &lt;dir&gt;</code>：数据目录的路径，如果没有指定的话默认使用 <code>&lt;name&gt;.etcd</code></li>
<li><code>--wal-dir &lt;dir&gt;</code>：WAL 目录路径，如果没有指定的话则使用数据目录</li>
<li><code>--initial-cluster &lt;configuration&gt;</code>：初始集群配置</li>
<li><code>initial-cluster-token</code>：初始 token</li>
<li><code>initial-advertise-peer-urls</code>：初始通告的成员 peer URLS</li>
<li><code>name</code>：集群成员名称</li>
<li><code>skip-hash-check</code>：忽略快照的 hash value</li>
</ul>
<p>示例：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ etcdctl snapshot restore test.db --initial-cluster-token etcd-cluster-1 --initial-advertise-peer-urls http://127.0.0.1:12380  --name sshot1 --initial-cluster <span class="string">&#x27;sshot1=http://127.0.0.1:12380,sshot2=http://127.0.0.1:22380,sshot3=http://127.0.0.1:32380&#x27;</span></span><br><span class="line">Deprecated: Use `etcdutl snapshot restore` instead.</span><br><span class="line"></span><br><span class="line">2022-02-24T13:03:33Z    info    snapshot/v3_snapshot.go:251     restoring snapshot      &#123;<span class="string">&quot;path&quot;</span>: <span class="string">&quot;test.db&quot;</span>, <span class="string">&quot;wal-dir&quot;</span>: <span class="string">&quot;sshot1.etcd/member/wal&quot;</span>, <span class="string">&quot;data-dir&quot;</span>: <span class="string">&quot;sshot1.etcd&quot;</span>, <span class="string">&quot;snap-dir&quot;</span>: <span class="string">&quot;sshot1.etcd/member/snap&quot;</span>, <span class="string">&quot;stack&quot;</span>: <span class="string">&quot;go.etcd.io/etcd/etcdutl/v3/snapshot.(*v3Manager).Restore\n\t/tmp/etcd-release-3.5.2/etcd/release/etcd/etcdutl/snapshot/v3_snapshot.go:257\ngo.etcd.io/etcd/etcdutl/v3/etcdutl.SnapshotRestoreCommandFunc\n\t/tmp/etcd-release-3.5.2/etcd/release/etcd/etcdutl/etcdutl/snapshot_command.go:147\ngo.etcd.io/etcd/etcdctl/v3/ctlv3/command.snapshotRestoreCommandFunc\n\t/tmp/etcd-release-3.5.2/etcd/release/etcd/etcdctl/ctlv3/command/snapshot_command.go:128\ngithub.com/spf13/cobra.(*Command).execute\n\t/usr/local/google/home/siarkowicz/.gvm/pkgsets/go1.16.3/global/pkg/mod/github.com/spf13/cobra@v1.1.3/command.go:856\ngithub.com/spf13/cobra.(*Command).ExecuteC\n\t/usr/local/google/home/siarkowicz/.gvm/pkgsets/go1.16.3/global/pkg/mod/github.com/spf13/cobra@v1.1.3/command.go:960\ngithub.com/spf13/cobra.(*Command).Execute\n\t/usr/local/google/home/siarkowicz/.gvm/pkgsets/go1.16.3/global/pkg/mod/github.com/spf13/cobra@v1.1.3/command.go:897\ngo.etcd.io/etcd/etcdctl/v3/ctlv3.Start\n\t/tmp/etcd-release-3.5.2/etcd/release/etcd/etcdctl/ctlv3/ctl.go:107\ngo.etcd.io/etcd/etcdctl/v3/ctlv3.MustStart\n\t/tmp/etcd-release-3.5.2/etcd/release/etcd/etcdctl/ctlv3/ctl.go:111\nmain.main\n\t/tmp/etcd-release-3.5.2/etcd/release/etcd/etcdctl/main.go:59\nruntime.main\n\t/usr/local/google/home/siarkowicz/.gvm/gos/go1.16.3/src/runtime/proc.go:225&quot;</span>&#125;</span><br><span class="line">2022-02-24T13:03:33Z    info    membership/store.go:141 Trimming membership information from the backend...</span><br><span class="line">2022-02-24T13:03:33Z    info    membership/cluster.go:421       added member    &#123;<span class="string">&quot;cluster-id&quot;</span>: <span class="string">&quot;ef37ad9dc622a7c4&quot;</span>, <span class="string">&quot;local-member-id&quot;</span>: <span class="string">&quot;0&quot;</span>, <span class="string">&quot;added-peer-id&quot;</span>: <span class="string">&quot;8211f1d0f64f3269&quot;</span>, <span class="string">&quot;added-peer-peer-urls&quot;</span>: [<span class="string">&quot;http://127.0.0.1:12380&quot;</span>]&#125;</span><br><span class="line">2022-02-24T13:03:33Z    info    membership/cluster.go:421       added member    &#123;<span class="string">&quot;cluster-id&quot;</span>: <span class="string">&quot;ef37ad9dc622a7c4&quot;</span>, <span class="string">&quot;local-member-id&quot;</span>: <span class="string">&quot;0&quot;</span>, <span class="string">&quot;added-peer-id&quot;</span>: <span class="string">&quot;91bc3c398fb3c146&quot;</span>, <span class="string">&quot;added-peer-peer-urls&quot;</span>: [<span class="string">&quot;http://127.0.0.1:22380&quot;</span>]&#125;</span><br><span class="line">2022-02-24T13:03:33Z    info    membership/cluster.go:421       added member    &#123;<span class="string">&quot;cluster-id&quot;</span>: <span class="string">&quot;ef37ad9dc622a7c4&quot;</span>, <span class="string">&quot;local-member-id&quot;</span>: <span class="string">&quot;0&quot;</span>, <span class="string">&quot;added-peer-id&quot;</span>: <span class="string">&quot;fd422379fda50e48&quot;</span>, <span class="string">&quot;added-peer-peer-urls&quot;</span>: [<span class="string">&quot;http://127.0.0.1:32380&quot;</span>]&#125;</span><br><span class="line">2022-02-24T13:03:33Z    info    snapshot/v3_snapshot.go:272     restored snapshot       &#123;<span class="string">&quot;path&quot;</span>: <span class="string">&quot;test.db&quot;</span>, <span class="string">&quot;wal-dir&quot;</span>: <span class="string">&quot;sshot1.etcd/member/wal&quot;</span>, <span class="string">&quot;data-dir&quot;</span>: <span class="string">&quot;sshot1.etcd&quot;</span>, <span class="string">&quot;snap-dir&quot;</span>: <span class="string">&quot;sshot1.etcd/member/snap&quot;</span>&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">etcd --name sshot1 --listen-client-urls http://127.0.0.1:2379 --advertise-client-urls http://127.0.0.1:2379 --listen-peer-urls http://127.0.0.1:12380 &amp;</span><br></pre></td></tr></table></figure>

<h4 id="查快快照"><a href="#查快快照" class="headerlink" title="查快快照"></a>查快快照</h4><p>命令语法：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SNAPSHOT STATUS &lt;filename&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li>用于查看后端数据库快照文件的详细信息</li>
</ul>
<p>示例：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ etcdctl snapshot status test.db</span><br><span class="line">Deprecated: Use `etcdutl snapshot status` instead.</span><br><span class="line"></span><br><span class="line">dc4be536, 48, 43, 25 kB</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">etcdctl snapshot status test.db -w table</span><br><span class="line">Deprecated: Use `etcdutl snapshot status` instead.</span><br><span class="line"></span><br><span class="line">+----------+----------+------------+------------+</span><br><span class="line">|   HASH   | REVISION | TOTAL KEYS | TOTAL SIZE |</span><br><span class="line">+----------+----------+------------+------------+</span><br><span class="line">| dc4be536 |       48 |         43 |      25 kB |</span><br><span class="line">+----------+----------+------------+------------+</span><br></pre></td></tr></table></figure>

<h3 id="MOVE-LEADER"><a href="#MOVE-LEADER" class="headerlink" title="MOVE-LEADER"></a>MOVE-LEADER</h3><p>命令语法：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">MOVE-LEADER</span><br></pre></td></tr></table></figure>

<ul>
<li>用于切换 etcd 集群中的 leader</li>
</ul>
<p>示例：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$ etcdctl endpoint status --cluster</span><br><span class="line">http://etcd1:2379, ade526d28b1f92f7, 3.5.2, 25 kB, <span class="literal">false</span>, <span class="literal">false</span>, 2, 89, 89,</span><br><span class="line">http://etcd3:2379, bd388e7810915853, 3.5.2, 25 kB, <span class="literal">true</span>, <span class="literal">false</span>, 2, 89, 89,</span><br><span class="line">http://etcd2:2379, d282ac2ce600c1ce, 3.5.2, 25 kB, <span class="literal">false</span>, <span class="literal">false</span>, 2, 89, 89,</span><br><span class="line"></span><br><span class="line">$ etcdctl endpoint status --cluster | grep -m 1 <span class="string">&quot;false&quot;</span> | awk -F<span class="string">&#x27;, &#x27;</span> <span class="string">&#x27;&#123;print $2&#125;&#x27;</span></span><br><span class="line">ade526d28b1f92f7</span><br><span class="line"></span><br><span class="line">$ etcdctl move-leader ade526d28b1f92f7</span><br><span class="line">Error: no leader endpoint given at [127.0.0.1:2379]</span><br><span class="line"></span><br><span class="line">$ etcdctl --endpoints bd388e7810915853 move-leader ade526d28b1f92f7</span><br></pre></td></tr></table></figure>

<h3 id="降级命令"><a href="#降级命令" class="headerlink" title="降级命令"></a>降级命令</h3><p>降级在 v3.6 中是实验性质的特性，并不推荐在生产环境中使用。降级命令用于对集群进行降级。通常来说，由于集群版本机制的问题，etcd 成员是不能降级的。</p>
<p>在初始启动后，集群成员对集群版本达成一致。每隔 5 s，leader 会检查所有成员的版本并选择最小的版本。如果新加入的成员，其版本低于当前的集群版本，该成员无法加入集群，这样可以防止集群被降级。而降级命令则允许集群管理员强制对集群进行降级。</p>
<p>降级应该分阶段执行：</p>
<ul>
<li>执行 <code>etcdctl downgrade validate &lt;TARGET_VERSION&gt;</code> 验证当前集群是否准备好进行降级</li>
<li><code>etcdctl downgrade enable &lt;TARGET_VERSION&gt;</code> 开始集群降级</li>
<li>对于每个成员<ul>
<li>通过检查其 log 中是否包含 <code>The server is ready to downgrade</code> 来确认成员准备好执行降级</li>
<li>替换成员的二进制版本</li>
<li>确认每个成员都正确启动并加入集群</li>
</ul>
</li>
<li>通过检查 leader log 中是否包含 <code>The server is ready to downgrade</code> 来确认降级是否成功</li>
</ul>
<h4 id="降级校验"><a href="#降级校验" class="headerlink" title="降级校验"></a>降级校验</h4><p>命令语法：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DOWNGRADE VALIDATE &lt;TARGET_VERSION&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li>在降级命令执行前检查是否能够进行降级</li>
</ul>
<h4 id="启动降级"><a href="#启动降级" class="headerlink" title="启动降级"></a>启动降级</h4><p>命令语法：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DOWNGRADE ENABLE &lt;TARGET_VERSION&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li>开始对集群进行降级</li>
</ul>
<h4 id="取消降级"><a href="#取消降级" class="headerlink" title="取消降级"></a>取消降级</h4><p>命令语法：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DOWNGRADE CANCEL &lt;TARGET_VERSION&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li>取消对集群的降级</li>
</ul>
<h2 id="并发命令"><a href="#并发命令" class="headerlink" title="并发命令"></a>并发命令</h2><h3 id="LOCK-命令"><a href="#LOCK-命令" class="headerlink" title="LOCK 命令"></a>LOCK 命令</h3><p>命令语法：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LOCK [options] &lt;lockname&gt; [<span class="built_in">command</span> arg1 arg2 ...]</span><br></pre></td></tr></table></figure>

<ul>
<li>获取一个分布式锁，该锁的名称由 <code>lockname</code> 指定。一旦 lock 获取到后，该锁一直会被持有，直到 etcdctl 命令终止</li>
<li>如果 lock 获取到，同时没有指定要执行的命令，那么会输出则会输出该 lock 的 KEY</li>
<li>如果 lock 获取到，同时指定了要执行的命令，那么换将变量 <code>ETCD_LOCK_KEY</code> 和 <code>ETCD_LOCK_KEY</code> 会输出成 lock 的 key 和 revision</li>
</ul>
<p>常用选项：</p>
<ul>
<li>lock 会话的超时时间</li>
</ul>
<p>示例：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ etcdctl lock mylock</span><br><span class="line">mylock/12f77f2076d86fa0</span><br><span class="line"></span><br><span class="line">$ etcdctl lock mylock etcdctl put foo bar</span><br><span class="line">OK</span><br></pre></td></tr></table></figure>

<p>注意事项：</p>
<ul>
<li>只有当 LOCK 命令是通过信号终止，并释放 lock 之后，LOCK 命令的退出码才是 0</li>
<li>如果 LOCK 命令是异常终止，或者无法让集群释放锁时，该 lock 会一直被占有，直到租约过期（60s）</li>
</ul>
<h3 id="ELECT-命令"><a href="#ELECT-命令" class="headerlink" title="ELECT 命令"></a>ELECT 命令</h3><p>命令语法：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ELECT [options] &lt;election-name&gt; [proposal]</span><br></pre></td></tr></table></figure>

<ul>
<li>ELECT 命令用于参加一个命名选举。通过在 ELECT 命令中提供一个 <code>prososal</code> 值，来表明本节点参与本选举</li>
<li>如果只是想观察选举，不用提供 <code>prososal</code> 值，但是需要使用 <code>listen</code> 选项</li>
<li>无论何时 leader 被选举后，它的 <code>prososal</code> 值都会被打印出来</li>
<li>对于候选人，如果该节点赢得了选举，会输出对应的 key 信息。如果是观察选举，ELECT 命令会持续输出选举的结果</li>
</ul>
<p>示例：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## etcd1</span></span><br><span class="line">$ etcdctl elect myelection etcd1</span><br><span class="line">myelection/12f77f2076d86fb4</span><br><span class="line">etcd1</span><br><span class="line"></span><br><span class="line"><span class="comment">## etcd2</span></span><br><span class="line">$ etcdctl elect myelection etcd2</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># observe</span></span><br><span class="line">$ etcdctl elect myelection -l</span><br><span class="line">myelection/12f77f2076d86fb4</span><br><span class="line">etcd1</span><br><span class="line"></span><br><span class="line"><span class="comment">## stop etcd1</span></span><br><span class="line"></span><br><span class="line">$ etcdctl elect myelection etcd2</span><br><span class="line">myelection/41ce7f2076d86923</span><br><span class="line">etcd2</span><br><span class="line"></span><br><span class="line">$ etcdctl elect myelection -l</span><br><span class="line">myelection/12f77f2076d86fb4</span><br><span class="line">etcd1</span><br><span class="line">myelection/41ce7f2076d86923</span><br><span class="line">etcd2</span><br></pre></td></tr></table></figure>

<p>注意事项：</p>
<ul>
<li>只有当 ELECT 命令是通过信号终止，并释放其候选人&#x2F;领导者身份的时候，ELECT 命令的退出码才是 0</li>
<li>如果候选人是异常终止，那么该选举过程会一直持续，直到默认租约过期（60s）</li>
</ul>
<h2 id="认证命令"><a href="#认证命令" class="headerlink" title="认证命令"></a>认证命令</h2><h3 id="开启-x2F-关闭认证"><a href="#开启-x2F-关闭认证" class="headerlink" title="开启&#x2F;关闭认证"></a>开启&#x2F;关闭认证</h3><p>命令语法：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">AUTH &lt;<span class="built_in">enable</span> or <span class="built_in">disable</span>&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li>用于开启或关闭 etcd 集群的认证机制。当开启 etcd 的认证机制的时候，etcd 会对所有请求进行认证检查</li>
<li>对应的 RPC：AuthEnable&#x2F;AuthDisable</li>
</ul>
<h3 id="添加角色"><a href="#添加角色" class="headerlink" title="添加角色"></a>添加角色</h3><p>命令语法：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ROLE ADD &lt;role name&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li>创建一个角色</li>
<li>对应的 RPC 方法：RoleAdd</li>
</ul>
<p>示例：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ etcdctl role add <span class="built_in">test</span></span><br><span class="line">Role <span class="built_in">test</span> created</span><br></pre></td></tr></table></figure>

<h3 id="获取角色"><a href="#获取角色" class="headerlink" title="获取角色"></a>获取角色</h3><p>命令语法：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ROLE GET &lt;role name&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li>获取详细的角色信息</li>
<li>对应的 RPC 方法 <code>RoleGet</code></li>
</ul>
<p>示例：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ etcdctl role get <span class="built_in">test</span></span><br><span class="line">Role <span class="built_in">test</span></span><br><span class="line">KV Read:</span><br><span class="line">KV Write:</span><br></pre></td></tr></table></figure>

<h3 id="删除角色"><a href="#删除角色" class="headerlink" title="删除角色"></a>删除角色</h3><p>命令语法：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ROLE DELETE &lt;role name&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li>删除指定角色</li>
<li>对应的 RPC 方法: RoleDelete</li>
</ul>
<p>示例：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ etcdctl role delete <span class="built_in">test</span></span><br><span class="line">Role <span class="built_in">test</span> deleted</span><br></pre></td></tr></table></figure>

<h3 id="列出角色"><a href="#列出角色" class="headerlink" title="列出角色"></a>列出角色</h3><p>命令语法：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ROLE LIST &lt;role name&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li>列出 etcd 中所有的角色</li>
<li>对应的 RPC 方法：RoleList</li>
</ul>
<p>示例：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ etcdctl role list</span><br><span class="line"><span class="built_in">test</span></span><br></pre></td></tr></table></figure>

<h3 id="角色授权"><a href="#角色授权" class="headerlink" title="角色授权"></a>角色授权</h3><p>命令语法：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ROLE GRANT-PERMISSION [options] &lt;role name&gt; &lt;permission <span class="built_in">type</span>&gt; &lt;key&gt; [endkey]</span><br></pre></td></tr></table></figure>

<ul>
<li>针对某个 key 或 key 范围，为 role 设置权限</li>
<li>对应的 RPC 方法为 RoleGrantPermission</li>
</ul>
<p>常用选项：</p>
<ul>
<li><code>--from-key</code>：为大于等于指定 key 的所有 key（通过字节比较排序）进行授权</li>
<li><code>--preifx</code>：使用前缀匹配</li>
</ul>
<p>示例：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">$ etcdctl role grant-permission <span class="built_in">test</span> readwrite test_key</span><br><span class="line">Role <span class="built_in">test</span> updated</span><br><span class="line"></span><br><span class="line">$ etcdctl role get <span class="built_in">test</span></span><br><span class="line">Role <span class="built_in">test</span></span><br><span class="line">KV Read:</span><br><span class="line">        test_key</span><br><span class="line">KV Write:</span><br><span class="line">        test_key</span><br><span class="line"></span><br><span class="line">$ etcdctl role grant-permission <span class="built_in">test</span> <span class="built_in">read</span> foo/ --prefix</span><br><span class="line">Role <span class="built_in">test</span> updated</span><br><span class="line">$ etcdctl role get <span class="built_in">test</span></span><br><span class="line">Role <span class="built_in">test</span></span><br><span class="line">KV Read:</span><br><span class="line">        [foo/, foo0) (prefix foo/)</span><br><span class="line">        test_key</span><br><span class="line">KV Write:</span><br><span class="line">        test_key</span><br></pre></td></tr></table></figure>

<h3 id="取消授权"><a href="#取消授权" class="headerlink" title="取消授权"></a>取消授权</h3><p>命令语法：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ROLE REVOKE-PERMISSION &lt;role name&gt; &lt;permission <span class="built_in">type</span>&gt; &lt;key&gt; [endkey]</span><br></pre></td></tr></table></figure>

<ul>
<li>针对某个 key 或者 key 范围，为 role 撤销权限</li>
<li>对应的 RPC 方法为 <code>RoleRevokePermission</code></li>
</ul>
<p>常用选项：</p>
<ul>
<li><code>--from-key</code>：为大于等于指定 key 的所有 key（通过字节比较排序）取消授权</li>
<li><code>--preifx</code>：使用前缀匹配</li>
</ul>
<p>示例：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ etcdctl role revoke-permission <span class="built_in">test</span> test_key</span><br><span class="line">Permission of key test_key is revoked from role <span class="built_in">test</span></span><br><span class="line"></span><br><span class="line">$ etcdctl role revoke-permission <span class="built_in">test</span> --prefix foo/</span><br><span class="line">Permission of range [foo/, foo0) is revoked from role <span class="built_in">test</span></span><br><span class="line"></span><br><span class="line">$ etcdctl role get <span class="built_in">test</span></span><br><span class="line">Role <span class="built_in">test</span></span><br><span class="line">KV Read:</span><br><span class="line">KV Write:</span><br></pre></td></tr></table></figure>

<h3 id="添加用户"><a href="#添加用户" class="headerlink" title="添加用户"></a>添加用户</h3><p>命令语法：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">USER ADD &lt;user name or user:password&gt; [options]</span><br></pre></td></tr></table></figure>

<ul>
<li>添加一个用户</li>
<li>对应的 RPC 方法为：UserAdd</li>
</ul>
<p>常用选项：</p>
<ul>
<li><code>--interactive</code>：交互模式，从标准输入中读取密码</li>
</ul>
<p>示例：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">etcdctl user add test_user</span><br><span class="line">Password of test_user:</span><br><span class="line">Type password of test_user again <span class="keyword">for</span> confirmation:</span><br><span class="line">User test_user created</span><br></pre></td></tr></table></figure>

<h3 id="获取用户"><a href="#获取用户" class="headerlink" title="获取用户"></a>获取用户</h3><p>命令语法：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">USER GET &lt;user name&gt; [options]</span><br></pre></td></tr></table></figure>

<ul>
<li>获取指定用户的信息</li>
<li>对应的RPC 方法 UserGet</li>
</ul>
<p>常用选项：</p>
<ul>
<li><code>--detail</code>：显示用户所对应的角色及权限</li>
</ul>
<p>示例：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">etcdctl user get test_user --detail</span><br><span class="line">User: test_user</span><br></pre></td></tr></table></figure>

<h3 id="删除用户"><a href="#删除用户" class="headerlink" title="删除用户"></a>删除用户</h3><p>命令语法：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">USER DELETE &lt;user name&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li>删除指定的用户</li>
<li>对应的 RPC 方法为 UserDelete</li>
</ul>
<p>示例：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ etcdctl user delete test_user</span><br><span class="line">User test_user deleted</span><br></pre></td></tr></table></figure>

<h3 id="列出用户"><a href="#列出用户" class="headerlink" title="列出用户"></a>列出用户</h3><p>命令语法：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">USER LIST</span><br></pre></td></tr></table></figure>

<p>示例：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ etcdctl user list</span><br><span class="line">test_user</span><br></pre></td></tr></table></figure>

<ul>
<li>列出所有的用户信息</li>
</ul>
<h3 id="设置密码"><a href="#设置密码" class="headerlink" title="设置密码"></a>设置密码</h3><p>命令语法：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">USER PASSWD &lt;user name&gt; [options]</span><br></pre></td></tr></table></figure>

<ul>
<li>修改用户的密码</li>
<li>对应的 RPC 方法：UserChangePassword</li>
</ul>
<p>常用选项：</p>
<ul>
<li><code>--interactive</code>：交互模式，从标准输入中读取密码</li>
</ul>
<p>示例：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ etcdctl user passwd test_user</span><br><span class="line">Password of test_user:</span><br><span class="line">Type password of test_user again <span class="keyword">for</span> confirmation:</span><br><span class="line">Password updated</span><br></pre></td></tr></table></figure>

<h3 id="设置用户角色"><a href="#设置用户角色" class="headerlink" title="设置用户角色"></a>设置用户角色</h3><p>命令语法：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">USER GRANT-ROLE &lt;user name&gt; &lt;role name&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li>为 user 指定角色</li>
<li>对应的 RPC 方法：UserGrantRole</li>
</ul>
<p>示例：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ etcdctl user grant-role test_user <span class="built_in">test</span></span><br><span class="line">Role <span class="built_in">test</span> is granted to user test_user</span><br></pre></td></tr></table></figure>

<h3 id="取消用户角色"><a href="#取消用户角色" class="headerlink" title="取消用户角色"></a>取消用户角色</h3><p>命令语法：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">USER REVOKE-ROLE &lt;user name&gt; &lt;role name&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li>撤销用户的角色</li>
<li>对应的 RPC 方法：UserRevokeRole</li>
</ul>
<p>示例：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ etcdctl user revoke-role test_user <span class="built_in">test</span></span><br><span class="line">Role <span class="built_in">test</span> is revoked from user test_user</span><br></pre></td></tr></table></figure>

<h2 id="工具命令"><a href="#工具命令" class="headerlink" title="工具命令"></a>工具命令</h2><h3 id="make-mirror"><a href="#make-mirror" class="headerlink" title="make-mirror"></a>make-mirror</h3><p>命令语法：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">MAKE-MIRROR [options] &lt;destination&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li>将 etcd 集群中的某些 key 映射到另一个 etcd 集群中</li>
</ul>
<p>常用选项</p>
<ul>
<li><code>--dest-cacert &lt;cacert&gt;</code>：目的集群的 TLS cacert 文件</li>
<li><code>--dest-cacert &lt;cert&gt;</code>：目的集群的 TLS cert 文件</li>
<li><code>--dest-key &lt;key&gt;</code>：目的集群的 TLS key 文件</li>
<li><code>--prefix</code>：按前缀匹配</li>
<li><code>dest-prefix</code>：指定在目标集群中的前缀</li>
<li><code>no-dest-prefix</code>：在目标集群的 root 下进行 mirror</li>
<li><code>dest-insecure-transport</code>：关闭传输层安全</li>
</ul>
<h3 id="版本"><a href="#版本" class="headerlink" title="版本"></a>版本</h3><p>命令语法：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">VERSION</span><br></pre></td></tr></table></figure>

<ul>
<li>输出 etcdctl 的版本</li>
</ul>
<p>示例：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ etcdctl version</span><br><span class="line">etcdctl version: 3.5.2</span><br><span class="line">API version: 3.5</span><br></pre></td></tr></table></figure>

<h3 id="CHECK"><a href="#CHECK" class="headerlink" title="CHECK"></a>CHECK</h3><p>用于检查 etcd 集群中的各个信息。</p>
<h4 id="性能检查"><a href="#性能检查" class="headerlink" title="性能检查"></a>性能检查</h4><p>命令语法：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CHECK PERF [options]</span><br></pre></td></tr></table></figure>

<ul>
<li>用于检查 etcd 集群的性能信息。</li>
<li>对应的 RPC 方法：CheckPerf</li>
</ul>
<p>常用选项：</p>
<ul>
<li><code>--load</code>：性能检查的负载模型，支持有：s(small), m(medium)、l(large)、xl(xlarge)</li>
<li><code>--prefix</code>：性能测试使用的 key 前缀</li>
<li><code>--auto-compact</code>：性能测试后，自动进行 compact</li>
<li><code>auto-defrag</code>：性能测试后自动进行 defragment</li>
</ul>
<p>示例：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">$ etcdctl check perf --load=<span class="string">&quot;s&quot;</span></span><br><span class="line"> 60 / 60 Booooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooo! 100.00% 1m0s</span><br><span class="line">PASS: Throughput is 149 writes/s</span><br><span class="line">PASS: Slowest request took 0.261242s</span><br><span class="line">PASS: Stddev is 0.013076s</span><br><span class="line">PASS</span><br><span class="line"></span><br><span class="line">$ etcdctl check perf --load=<span class="string">&quot;l&quot;</span></span><br><span class="line">FAIL: too many errors</span><br><span class="line">FAIL: ERROR(etcdserver: request timed out) -&gt; 287</span><br><span class="line">FAIL: Throughput too low: 297 writes/s</span><br><span class="line">Slowest request took too long: 8.325122s</span><br><span class="line">Stddev too high: 1.062989s</span><br><span class="line">FAIL</span><br></pre></td></tr></table></figure>

<h4 id="数据规模检查"><a href="#数据规模检查" class="headerlink" title="数据规模检查"></a>数据规模检查</h4><p>命令语法：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CHECK DATASCALE [options]</span><br></pre></td></tr></table></figure>

<ul>
<li>检查在一个指定的 endpoint server 上，不同负载情况下保存数据所需要使用的内存</li>
<li>对应的 RPC 方法 <code>CheckDatascale</code></li>
</ul>
<p>常用选项：</p>
<ul>
<li><code>--load</code>：所使用的负载模型，支持有：s(small), m(medium)、l(large)、xl(xlarge)</li>
<li><code>--prefix</code>：所使用的 key 前缀</li>
<li><code>--auto-compact</code>：性能测试后，自动进行 compact</li>
<li><code>auto-defrag</code>：性能测试后自动进行 defragment</li>
</ul>
<p>示例：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ etcdctl check datascale --load=<span class="string">&quot;s&quot;</span></span><br><span class="line">Start data scale check <span class="keyword">for</span> work load [10000 key-value pairs, 1024 bytes per key-value, 50 concurrent clients].</span><br><span class="line"> 10000 / 10000 Boooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooo! 100.00% 14s</span><br><span class="line">PASS: Approximate system memory used : 91.16 MB.</span><br></pre></td></tr></table></figure>

<h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ul>
<li><a target="_blank" rel="noopener" href="https://github.com/etcd-io/etcd/tree/main/etcdctl">etcdctl</a></li>
</ul>

    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/fuchencong.github.io/tags/etcdctl/" rel="tag"># etcdctl</a>
              <a href="/fuchencong.github.io/tags/etcd/" rel="tag"># etcd</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/fuchencong.github.io/2022/04/05/k8s-network-01/" rel="prev" title="Kubernetes 网络权威指南（01）：Linux 网络虚拟化">
      <i class="fa fa-chevron-left"></i> Kubernetes 网络权威指南（01）：Linux 网络虚拟化
    </a></div>
      <div class="post-nav-item">
    <a href="/fuchencong.github.io/2022/01/26/go-develop-notes-01/" rel="next" title="golang-lru 源码分析">
      golang-lru 源码分析 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%80%9A%E7%94%A8%E8%AF%B4%E6%98%8E"><span class="nav-number">1.</span> <span class="nav-text">通用说明</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Key-value-%E5%91%BD%E4%BB%A4"><span class="nav-number">2.</span> <span class="nav-text">Key-value 命令</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%AE%BE%E7%BD%AE-key"><span class="nav-number">2.1.</span> <span class="nav-text">设置 key</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%8E%B7%E5%8F%96-key"><span class="nav-number">2.2.</span> <span class="nav-text">获取 key</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%A0%E9%99%A4-key"><span class="nav-number">2.3.</span> <span class="nav-text">删除 key</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BA%8B%E5%8A%A1"><span class="nav-number">2.4.</span> <span class="nav-text">事务</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8E%8B%E7%BC%A9"><span class="nav-number">2.5.</span> <span class="nav-text">压缩</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#WATCH"><span class="nav-number">2.6.</span> <span class="nav-text">WATCH</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%A7%9F%E7%BA%A6"><span class="nav-number">2.7.</span> <span class="nav-text">租约</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E7%A7%9F%E7%BA%A6"><span class="nav-number">2.7.1.</span> <span class="nav-text">创建租约</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%87%8A%E6%94%BE%E7%A7%9F%E7%BA%A6"><span class="nav-number">2.7.2.</span> <span class="nav-text">释放租约</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%8E%B7%E5%8F%96%E7%A7%9F%E7%BA%A6"><span class="nav-number">2.7.3.</span> <span class="nav-text">获取租约</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%8E%B7%E5%8F%96%E7%A7%9F%E7%BA%A6%E5%88%97%E8%A1%A8"><span class="nav-number">2.7.4.</span> <span class="nav-text">获取租约列表</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%BB%AD%E7%BA%A6"><span class="nav-number">2.7.5.</span> <span class="nav-text">续约</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%9B%86%E7%BE%A4%E7%BB%B4%E6%8A%A4%E5%91%BD%E4%BB%A4"><span class="nav-number">3.</span> <span class="nav-text">集群维护命令</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%88%90%E5%91%98%E7%AE%A1%E7%90%86"><span class="nav-number">3.1.</span> <span class="nav-text">成员管理</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%B7%BB%E5%8A%A0%E6%88%90%E5%91%98"><span class="nav-number">3.1.1.</span> <span class="nav-text">添加成员</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%9B%B4%E6%96%B0%E6%88%90%E5%91%98"><span class="nav-number">3.1.2.</span> <span class="nav-text">更新成员</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%A7%BB%E9%99%A4%E6%88%90%E5%91%98"><span class="nav-number">3.1.3.</span> <span class="nav-text">移除成员</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%88%97%E5%87%BA%E6%88%90%E5%91%98"><span class="nav-number">3.1.4.</span> <span class="nav-text">列出成员</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ENDPOINT-%E5%91%BD%E4%BB%A4"><span class="nav-number">3.2.</span> <span class="nav-text">ENDPOINT 命令</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%8A%82%E7%82%B9%E5%81%A5%E5%BA%B7%E4%BF%A1%E6%81%AF"><span class="nav-number">3.2.1.</span> <span class="nav-text">节点健康信息</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%8A%82%E7%82%B9%E7%8A%B6%E6%80%81"><span class="nav-number">3.2.2.</span> <span class="nav-text">节点状态</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%8A%82%E7%82%B9-HASHKV"><span class="nav-number">3.2.3.</span> <span class="nav-text">节点 HASHKV</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ALARM-%E5%91%BD%E4%BB%A4"><span class="nav-number">3.3.</span> <span class="nav-text">ALARM 命令</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%A7%A3%E9%99%A4%E8%AD%A6%E5%91%8A"><span class="nav-number">3.3.1.</span> <span class="nav-text">解除警告</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%88%97%E5%87%BA%E8%AD%A6%E5%91%8A"><span class="nav-number">3.3.2.</span> <span class="nav-text">列出警告</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%A2%8E%E7%89%87%E6%95%B4%E7%90%86"><span class="nav-number">3.4.</span> <span class="nav-text">碎片整理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BF%AB%E7%85%A7%E5%91%BD%E4%BB%A4"><span class="nav-number">3.5.</span> <span class="nav-text">快照命令</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BF%9D%E5%AD%98%E5%BF%AB%E7%85%A7"><span class="nav-number">3.5.1.</span> <span class="nav-text">保存快照</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%81%A2%E5%A4%8D%E5%BF%AB%E7%85%A7"><span class="nav-number">3.5.2.</span> <span class="nav-text">恢复快照</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%9F%A5%E5%BF%AB%E5%BF%AB%E7%85%A7"><span class="nav-number">3.5.3.</span> <span class="nav-text">查快快照</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#MOVE-LEADER"><span class="nav-number">3.6.</span> <span class="nav-text">MOVE-LEADER</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%99%8D%E7%BA%A7%E5%91%BD%E4%BB%A4"><span class="nav-number">3.7.</span> <span class="nav-text">降级命令</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%99%8D%E7%BA%A7%E6%A0%A1%E9%AA%8C"><span class="nav-number">3.7.1.</span> <span class="nav-text">降级校验</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%90%AF%E5%8A%A8%E9%99%8D%E7%BA%A7"><span class="nav-number">3.7.2.</span> <span class="nav-text">启动降级</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%8F%96%E6%B6%88%E9%99%8D%E7%BA%A7"><span class="nav-number">3.7.3.</span> <span class="nav-text">取消降级</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%B9%B6%E5%8F%91%E5%91%BD%E4%BB%A4"><span class="nav-number">4.</span> <span class="nav-text">并发命令</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#LOCK-%E5%91%BD%E4%BB%A4"><span class="nav-number">4.1.</span> <span class="nav-text">LOCK 命令</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ELECT-%E5%91%BD%E4%BB%A4"><span class="nav-number">4.2.</span> <span class="nav-text">ELECT 命令</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%AE%A4%E8%AF%81%E5%91%BD%E4%BB%A4"><span class="nav-number">5.</span> <span class="nav-text">认证命令</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BC%80%E5%90%AF-x2F-%E5%85%B3%E9%97%AD%E8%AE%A4%E8%AF%81"><span class="nav-number">5.1.</span> <span class="nav-text">开启&#x2F;关闭认证</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B7%BB%E5%8A%A0%E8%A7%92%E8%89%B2"><span class="nav-number">5.2.</span> <span class="nav-text">添加角色</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%8E%B7%E5%8F%96%E8%A7%92%E8%89%B2"><span class="nav-number">5.3.</span> <span class="nav-text">获取角色</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%A0%E9%99%A4%E8%A7%92%E8%89%B2"><span class="nav-number">5.4.</span> <span class="nav-text">删除角色</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%97%E5%87%BA%E8%A7%92%E8%89%B2"><span class="nav-number">5.5.</span> <span class="nav-text">列出角色</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%A7%92%E8%89%B2%E6%8E%88%E6%9D%83"><span class="nav-number">5.6.</span> <span class="nav-text">角色授权</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8F%96%E6%B6%88%E6%8E%88%E6%9D%83"><span class="nav-number">5.7.</span> <span class="nav-text">取消授权</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B7%BB%E5%8A%A0%E7%94%A8%E6%88%B7"><span class="nav-number">5.8.</span> <span class="nav-text">添加用户</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%8E%B7%E5%8F%96%E7%94%A8%E6%88%B7"><span class="nav-number">5.9.</span> <span class="nav-text">获取用户</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%A0%E9%99%A4%E7%94%A8%E6%88%B7"><span class="nav-number">5.10.</span> <span class="nav-text">删除用户</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%97%E5%87%BA%E7%94%A8%E6%88%B7"><span class="nav-number">5.11.</span> <span class="nav-text">列出用户</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%AE%BE%E7%BD%AE%E5%AF%86%E7%A0%81"><span class="nav-number">5.12.</span> <span class="nav-text">设置密码</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%AE%BE%E7%BD%AE%E7%94%A8%E6%88%B7%E8%A7%92%E8%89%B2"><span class="nav-number">5.13.</span> <span class="nav-text">设置用户角色</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8F%96%E6%B6%88%E7%94%A8%E6%88%B7%E8%A7%92%E8%89%B2"><span class="nav-number">5.14.</span> <span class="nav-text">取消用户角色</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%B7%A5%E5%85%B7%E5%91%BD%E4%BB%A4"><span class="nav-number">6.</span> <span class="nav-text">工具命令</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#make-mirror"><span class="nav-number">6.1.</span> <span class="nav-text">make-mirror</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%89%88%E6%9C%AC"><span class="nav-number">6.2.</span> <span class="nav-text">版本</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#CHECK"><span class="nav-number">6.3.</span> <span class="nav-text">CHECK</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%80%A7%E8%83%BD%E6%A3%80%E6%9F%A5"><span class="nav-number">6.3.1.</span> <span class="nav-text">性能检查</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E8%A7%84%E6%A8%A1%E6%A3%80%E6%9F%A5"><span class="nav-number">6.3.2.</span> <span class="nav-text">数据规模检查</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Reference"><span class="nav-number">7.</span> <span class="nav-text">Reference</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="fuchencong"
      src="/fuchencong.github.io/images/logo.jpeg">
  <p class="site-author-name" itemprop="name">fuchencong</p>
  <div class="site-description" itemprop="description">Having dreams is what makes life tolerable.</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/fuchencong.github.io/archives/">
        
          <span class="site-state-item-count">169</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/fuchencong.github.io/categories/">
          
        <span class="site-state-item-count">14</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/fuchencong.github.io/tags/">
          
        <span class="site-state-item-count">31</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/fuchencong" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;fuchencong" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:fuchencong@163.com" title="E-Mail → mailto:fuchencong@163.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">fuchencong</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/fuchencong.github.io/lib/anime.min.js"></script>
  <script src="/fuchencong.github.io/lib/velocity/velocity.min.js"></script>
  <script src="/fuchencong.github.io/lib/velocity/velocity.ui.min.js"></script>

<script src="/fuchencong.github.io/js/utils.js"></script>

<script src="/fuchencong.github.io/js/motion.js"></script>


<script src="/fuchencong.github.io/js/schemes/muse.js"></script>


<script src="/fuchencong.github.io/js/next-boot.js"></script>




  















  

  

</body>
</html>
