<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/fuchencong.github.io/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/fuchencong.github.io/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/fuchencong.github.io/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/fuchencong.github.io/images/logo.svg" color="#222">

<link rel="stylesheet" href="/fuchencong.github.io/css/main.css">


<link rel="stylesheet" href="/fuchencong.github.io/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"fuchencong.github.io","root":"/fuchencong.github.io/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"right","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="Pecan 是轻量级的 Python web 开发框架，它用于填补 Python web 框架世界中的一个空白：即提供对象分发（object-dispatch）风格的路由。Pecan 并不打算成为一个全栈框架，因此并不包含一些开箱即用的工具：例如对 sessions、databases 的支持，相反 Pecan 聚焦于 HTTP 本身。">
<meta property="og:type" content="article">
<meta property="og:title" content="Python Pecan web 框架简介">
<meta property="og:url" content="https://fuchencong.github.io/fuchencong.github.io/2021/12/12/python-pecan/index.html">
<meta property="og:site_name" content="fuchencong">
<meta property="og:description" content="Pecan 是轻量级的 Python web 开发框架，它用于填补 Python web 框架世界中的一个空白：即提供对象分发（object-dispatch）风格的路由。Pecan 并不打算成为一个全栈框架，因此并不包含一些开箱即用的工具：例如对 sessions、databases 的支持，相反 Pecan 聚焦于 HTTP 本身。">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2021-12-12T12:55:54.000Z">
<meta property="article:modified_time" content="2022-08-25T12:04:03.767Z">
<meta property="article:author" content="fuchencong">
<meta property="article:tag" content="Python">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://fuchencong.github.io/fuchencong.github.io/2021/12/12/python-pecan/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>Python Pecan web 框架简介 | fuchencong</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/fuchencong.github.io/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">fuchencong</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">The way I am</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/fuchencong.github.io/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/fuchencong.github.io/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/fuchencong.github.io/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/fuchencong.github.io/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/fuchencong.github.io/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://fuchencong.github.io/fuchencong.github.io/2021/12/12/python-pecan/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/fuchencong.github.io/images/logo.jpeg">
      <meta itemprop="name" content="fuchencong">
      <meta itemprop="description" content="Having dreams is what makes life tolerable.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fuchencong">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Python Pecan web 框架简介
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-12-12 20:55:54" itemprop="dateCreated datePublished" datetime="2021-12-12T20:55:54+08:00">2021-12-12</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/fuchencong.github.io/categories/Python-%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0/" itemprop="url" rel="index"><span itemprop="name">Python 开发笔记</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>Pecan 是轻量级的 Python web 开发框架，它用于填补 Python web 框架世界中的一个空白：即提供对象分发（object-dispatch）风格的路由。Pecan 并不打算成为一个全栈框架，因此并不包含一些开箱即用的工具：例如对 sessions、databases 的支持，相反 Pecan 聚焦于 HTTP 本身。</p>
<span id="more"></span>

<p>尽管 Pecan 非常轻量，但是仍然为构建基于 HTTP 的应用程序提供大量扩展支持：</p>
<ul>
<li>采用对象分发式的路由风格</li>
<li>对 REST 风格控制器的完全支持</li>
<li>可扩展的安全框架</li>
<li>可扩展的模板语言支持</li>
<li>可扩展的 JSON 输出</li>
<li>简易的基于 Python 的配置</li>
</ul>
<h2 id="安装-Pecan"><a href="#安装-Pecan" class="headerlink" title="安装 Pecan"></a>安装 Pecan</h2><p>首先创建一个虚拟环境：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ virtualenv pecan-env</span><br><span class="line">$ cd pecan-env</span><br><span class="line">$ source <span class="built_in">bin</span>/activate</span><br></pre></td></tr></table></figure>

<p>之后使用 <code>pip</code> 安装 <code>Pecan</code>：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install pecan</span><br></pre></td></tr></table></figure>

<h2 id="牛刀小试"><a href="#牛刀小试" class="headerlink" title="牛刀小试"></a>牛刀小试</h2><p>接下来将创建一个 Pecan 应用程序，这里直接使用 <code>pecan create</code> 命令，它会基于模板创建一个 Pecan 应用程序：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pecan create hello_pecan</span><br></pre></td></tr></table></figure>

<p>之后进入 <code>hello_pecan</code> 程序目录，使用开发模式安装到系统，这样对源码的修改可以立即生效：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd hello_pecan</span><br><span class="line"></span><br><span class="line">python setup.py develop</span><br></pre></td></tr></table></figure>

<p>Pecan 基于模板创建的程序目录中包含如下主要文件：</p>
<ul>
<li>public 目录：存放所有的静态文件。Pecan 自带一个简答的文件服务器，因此开发模式下可以直接访问这些文件</li>
<li>config.py：包含了运行 Pecan 应用程序所需要的基本配置。为了使用方便，Pecan 使用纯 Python 文件作为配置文件</li>
</ul>
<p>Pecan 应用程序的结构也遵循 MVC 模式，因此包含如下目录：</p>
<ul>
<li>hello_pecan&#x2F;controllers：存放所有的 controller 文件</li>
<li>hello_pecan&#x2F;templates：存放所有的 template 文件</li>
<li>hello_pecan&#x2F;templates：存放所有的 model 文件</li>
</ul>
<p>还包含一个测试目录：</p>
<ul>
<li>hello_pecan&#x2F;tests：用于存放单元测试和集成测试文件：</li>
</ul>
<p>最后再分析 hello_pecan&#x2F;app.py 文件，它用于控制 Pecan 程序如何创建。它包含一个 setup_app() 函数用于返回一个 WSGI 应用程序。</p>
<p>接下来使用 <code>pecan serve</code> 命令启动一个开放服务器，并运行该应用程序：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ pecan serve config.py</span><br><span class="line">Starting server <span class="keyword">in</span> PID <span class="number">000.</span></span><br><span class="line">serving on <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span>:<span class="number">8080</span>, view at http://<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">8080</span></span><br></pre></td></tr></table></figure>

<h3 id="应用程序入口点"><a href="#应用程序入口点" class="headerlink" title="应用程序入口点"></a>应用程序入口点</h3><p>RootController 是应用程序的入口点。我们测试程序的 RootController 位于 <code>hello_pecan/controllers/root.py</code> 文件中：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pecan <span class="keyword">import</span> expose, redirect</span><br><span class="line"><span class="keyword">from</span> webob.exc <span class="keyword">import</span> status_map</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">RootController</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line"></span><br><span class="line"><span class="meta">    @expose(<span class="params">generic=<span class="literal">True</span>, template=<span class="string">&#x27;index.html&#x27;</span></span>)</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">index</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">dict</span>()</span><br><span class="line"></span><br><span class="line"><span class="meta">    @index.when(<span class="params">method=<span class="string">&#x27;POST&#x27;</span></span>)</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">index_post</span>(<span class="params">self, q</span>):</span><br><span class="line">        redirect(<span class="string">&#x27;https://pecan.readthedocs.io/en/latest/search.html?q=%s&#x27;</span> % q)</span><br><span class="line"></span><br><span class="line"><span class="meta">    @expose(<span class="params"><span class="string">&#x27;error.html&#x27;</span></span>)</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">error</span>(<span class="params">self, status</span>):</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            status = <span class="built_in">int</span>(status)</span><br><span class="line">        <span class="keyword">except</span> ValueError:  <span class="comment"># pragma: no cover</span></span><br><span class="line">            status = <span class="number">500</span></span><br><span class="line">        message = <span class="built_in">getattr</span>(status_map.get(status), <span class="string">&#x27;explanation&#x27;</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">dict</span>(status=status, message=message)</span><br></pre></td></tr></table></figure>

<p>简单分析一下这段代码：</p>
<ul>
<li>index 方法通过 expose() 装饰器被标记为可公开访问，所以访问应用程序的 root（即 <code>/</code>）的 HTTP GET 请求都会被路由到该方法</li>
<li>index 方法返回一个字典，该字典将被用于渲染特定的模板，这里即为 <code>index.html</code>，从而返回一个 HTML。这也是将数据从 controller 传给 template 的主要机制</li>
<li><code>index_post()</code> 被 <code>@index.when(method=&#39;POST&#39;)</code> 装饰器修饰，因此所有访问应用程序 root 的 HTTP POST 请求都会被路由到该方法。POST 请求的参数也会被传递给 index_post 方法</li>
<li><code>error()</code> 方法允许对 HTTP 错误显示自定义页面</li>
</ul>
<h2 id="Controller-和-路由"><a href="#Controller-和-路由" class="headerlink" title="Controller 和 路由"></a>Controller 和 路由</h2><p>Pecan 使用<code>对象分发</code>（object-dispatch）的路由策略来将 HTTP 请求映射到某一个 controller，然后调用其相应的方法。对象分发会把访问 URI 分割为一系列的组件，然后根据路径访问对象，首先是 root controller。可以把应用程序所有的 controller 想象为 objects 树，对象树的某个分支就直接映射为相应的 URL 路径。</p>
<p>举个例子：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pecan <span class="keyword">import</span> expose</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BooksController</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line"><span class="meta">    @expose()</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">index</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Welcome to book section.&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @expose()</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">bestsellers</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;We have 5 books in the top 10.&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CatalogController</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line"><span class="meta">    @expose()</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">index</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Welcome to the catalog.&quot;</span></span><br><span class="line"></span><br><span class="line">    books = BooksController()</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">RootController</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line"><span class="meta">    @expose()</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">index</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Welcome to store.example.com!&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @expose()</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">hours</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Open 24/7 on the web.&quot;</span></span><br><span class="line"></span><br><span class="line">    catalog = CatalogController()</span><br></pre></td></tr></table></figure>

<p>如果某一个请求访问路径 <code>/catalog/books/bestsellers</code>，那么 Pecan 会把该请求分割为 <code>catelog</code>、<code>books</code>、<code>bestsellers</code>、然后会在 <code>RootController</code> 下寻找 <code>catelog</code> 对象，然后使用 <code>catelog</code> 对象，寻找 <code>books</code> 对象，之后再在 books 对象中寻找 <code>bestsellers</code>。如果 URI 的最后部分是一个 controller 对象，则调用该 controller 对象的 <code>index</code> 方法。</p>
<p>例如访问如下路径：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">└── /</span><br><span class="line">    ├── /hours</span><br><span class="line">    └── /catalog</span><br><span class="line">         └── /catalog/books</span><br><span class="line">            └── /catalog/books/bestsellers</span><br></pre></td></tr></table></figure>

<p>最终会调用如下 controller 的方法：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">└── RootController.index</span><br><span class="line">    ├── RootController.hours</span><br><span class="line">    └── CatalogController.index</span><br><span class="line">         └── BooksController.index</span><br><span class="line">            └── BooksController.bestsellers</span><br></pre></td></tr></table></figure>

<h3 id="导出-controller"><a href="#导出-controller" class="headerlink" title="导出 controller"></a>导出 controller</h3><p>通过 <code>expose</code> 装饰器可以告诉 Pecan 类中的哪些方法是公共可见的，如果类中的方法没有使用 <code>expose()</code> 装饰，Pecan 不会将该请求路由到该方法上。<code>expose()</code> 可以有多种用途：</p>
<ul>
<li>如果没有传递任何参数，那么 controller 方法返回的内容将以字符串的形式作为 HTML 响应体</li>
<li>更常见的场景是在 <code>expose()</code> 方法中将需要渲染的模板作为参数，然后 <code>controller</code> 方法返回一个字典，作为渲染的输入（namespace）</li>
<li>expose() 方法可以叠加，这样可以根据请求（例如根据请求头中的 <code>Accept</code> 字段） 返回不同的样式内容。</li>
</ul>
<h3 id="指定显式的路径分段"><a href="#指定显式的路径分段" class="headerlink" title="指定显式的路径分段"></a>指定显式的路径分段</h3><p>有时，你可能会碰到这样一个问题：URI 中的路径分段和 Pecan 控制器中的方法名称不一致（例如受限于 Python 的语法）。举个例子：访问的路径中包含 <code>-</code>，那么在 Python 中如下方法是非法的：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">RootController</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line"></span><br><span class="line"><span class="meta">    @pecan.expose()</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">some</span>-path(self):</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">dict</span>()</span><br></pre></td></tr></table></figure>

<p>为了解决该问题，可以在 <code>expose</code> 装饰器指定显式的路径分段：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">RootController</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line"></span><br><span class="line"><span class="meta">    @pecan.expose(<span class="params">route=<span class="string">&#x27;some-path&#x27;</span></span>)</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">some_path</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">dict</span>()</span><br></pre></td></tr></table></figure>

<p>此时可以顺利访问 <code>/some-path</code>，但是访问 <code>/some-path</code> 则会失败。</p>
<p>还有一种方式是直接在 Pecan 中使用 <code>route</code> 方法，如下所示：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">RootController</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line"></span><br><span class="line"><span class="meta">    @pecan.expose()</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">some_path</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">dict</span>()</span><br><span class="line"></span><br><span class="line">pecan.route(<span class="string">&#x27;some-path&#x27;</span>, RootController.some_path)</span><br></pre></td></tr></table></figure>

<h3 id="基于请求方法进行路由"><a href="#基于请求方法进行路由" class="headerlink" title="基于请求方法进行路由"></a>基于请求方法进行路由</h3><p><code>expose()</code> 方法的 <code>generic</code> 参数使得我们可以基于请求方法来重载 URL。例如下面的例子中，虽然是同一个 URL，但是可以被两个不同的方法访问，每个请求方法路由到对应的 controller method 上。这里使用到了 <code>generic controller</code>：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">RootController</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line"></span><br><span class="line">    <span class="comment"># HTTP GET /</span></span><br><span class="line"><span class="meta">    @expose(<span class="params">generic=<span class="literal">True</span>, template=<span class="string">&#x27;json&#x27;</span></span>)</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">index</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">dict</span>()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># HTTP POST /</span></span><br><span class="line"><span class="meta">    @index.when(<span class="params">method=<span class="string">&#x27;POST&#x27;</span>, template=<span class="string">&#x27;json&#x27;</span></span>)</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">index_POST</span>(<span class="params">self, **kw</span>):</span><br><span class="line">        uuid = create_something()</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">dict</span>(uuid=uuid)</span><br></pre></td></tr></table></figure>

<h3 id="使用-lookup-路由到-Subcontrollers"><a href="#使用-lookup-路由到-Subcontrollers" class="headerlink" title="使用 _lookup 路由到 Subcontrollers"></a>使用 <code>_lookup</code> 路由到 <code>Subcontrollers</code></h3><p>有时标准的对象分发机制不足以将某个 URL 映射到对应的 controller。 Pecan 提供一些方法可以对路由机制提供更多控制，从而为 URL 路由提供更大的灵活性。</p>
<p><code>_lookup()</code> 方法提供了一种方式：只处理 URL 中的一部分，然后返回一个新的控制器，用来处理 URL 的剩余部分。<code>_lookup()</code> 方法可以接受一个或多个参数，用于表示 URL 中要处理的分段。另外它也包含一个可变长位置参数，用于表示不处理的 URL 分段。而且，所有不处理的 URL 分段也需要被返回。</p>
<p>除了使用 <code>_lookup</code> 来动态创建 <code>controllers</code>，<code>_lookup()</code> 也是 Pecan 最后尝试调用的函数（当 controller 的所有方法都不匹配 URL 且没有 <code>_default()</code> 方法。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pecan <span class="keyword">import</span> expose, abort</span><br><span class="line"><span class="keyword">from</span> somelib <span class="keyword">import</span> get_student_by_name</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">StudentController</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, student</span>):</span><br><span class="line">        self.student = student</span><br><span class="line"></span><br><span class="line"><span class="meta">    @expose()</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">name</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> self.student.name</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">RootController</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line"><span class="meta">    @expose()</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_lookup</span>(<span class="params">self, primary_key, *remainder</span>):</span><br><span class="line">        student = get_student_by_primary_key(primary_key)</span><br><span class="line">        <span class="keyword">if</span> student:</span><br><span class="line">            <span class="keyword">return</span> StudentController(student), remainder</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            abort(<span class="number">404</span>)</span><br></pre></td></tr></table></figure>

<p>这样访问 <code>/8/name</code> 的 HTTP GET 请求会返回指定 Student 的 name，该 Student 的 <code>primary_key</code> &#x3D;&#x3D; 8</p>
<h3 id="default-方法"><a href="#default-方法" class="headerlink" title="_default() 方法"></a><code>_default()</code> 方法</h3><p>在通过标准的对象分发对 URL 进行路由时，<code>_default()</code> 方法是最后尝试调用的方法：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pecan <span class="keyword">import</span> expose</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">RootController</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line"><span class="meta">    @expose()</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">english</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;hello&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @expose()</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">french</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;bonjour&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @expose()</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_default</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;I cannot say hello in that language&#x27;</span></span><br></pre></td></tr></table></figure>

<p>在该例子中，访问 <code>/spanish</code>，会导致请求路由到 <code> RootController._default()</code> 方法。</p>
<h3 id="route-自定义路由"><a href="#route-自定义路由" class="headerlink" title="_route 自定义路由"></a><code>_route</code> 自定义路由</h3><p><code>_route()</code> 方法允许控制器完全覆盖 Pecan 的路由机制，Pecan 使用 <code>_route()</code> 方法来实现它的 RestController。如果你想在 Pecan 之上设计另一套路由系统，可以定义一个包含自定义 <code>_route()</code> 方法的基控制器类。</p>
<h2 id="和-Request-和-Response-对象进行交互"><a href="#和-Request-和-Response-对象进行交互" class="headerlink" title="和 Request 和 Response 对象进行交互"></a>和 Request 和 Response 对象进行交互</h2><p>对于每一个 HTTP 请求，Pecan 都会维护一个对 <code>request</code>&#x2F;<code>response</code> 对象的 <code>thread-local</code> 引用：<code>pecan.request</code> 和 <code>pecan.response</code>。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@pecan.expose()</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">login</span>(<span class="params">self</span>):</span><br><span class="line">    <span class="keyword">assert</span> pecan.request.path == <span class="string">&#x27;/login&#x27;</span></span><br><span class="line">    username = pecan.request.POST.get(<span class="string">&#x27;username&#x27;</span>)</span><br><span class="line">    password = pecan.request.POST.get(<span class="string">&#x27;password&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    pecan.response.status = <span class="number">403</span></span><br><span class="line">    pecan.response.text = <span class="string">&#x27;Bad Login!&#x27;</span></span><br></pre></td></tr></table></figure>

<p>可以通过 abort() 函数来抛出一个 <code>WSGIHTTPException</code> 类型的异常，Pecan 会使用该异常来渲染 HTTP 错误的默认响应 body。</p>
<p>WebOp 提供的请求和响应实现已经足够强大了，但是有时我们还是对 <code>request</code> 和 <code>response</code> 进行扩展。如果想实现这一点，可以继承 <code>pecan.Request</code> 和 <code>pecan.Response</code> 创建自定义对应类型：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MyRequest</span>(pecan.Request):</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyResponse</span>(pecan.Response):</span><br><span class="line">    <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>

<p>然后修改程序配置：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> myproject <span class="keyword">import</span> MyRequest, MyResponse</span><br><span class="line"></span><br><span class="line">app = &#123;</span><br><span class="line">    <span class="string">&#x27;root&#x27;</span> : <span class="string">&#x27;project.controllers.root.RootController&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;modules&#x27;</span> : [<span class="string">&#x27;project&#x27;</span>],</span><br><span class="line">    <span class="string">&#x27;static_root&#x27;</span>   : <span class="string">&#x27;%(confdir)s/public&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;template_path&#x27;</span> : <span class="string">&#x27;%(confdir)s/project/templates&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;request_cls&#x27;</span>: MyRequest,</span><br><span class="line">    <span class="string">&#x27;response_cls&#x27;</span>: MyResponse</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="控制器参数"><a href="#控制器参数" class="headerlink" title="控制器参数"></a>控制器参数</h3><p>HTTP GET 和 POST 请求中的未被路由过程处理的的变量都会被传递给控制器的方法，并作为其参数。取决于方法的签名，这些参数可以进行显示映射：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pecan <span class="keyword">import</span> expose</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">RootController</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line"><span class="meta">    @expose()</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">index</span>(<span class="params">self, arg</span>):</span><br><span class="line">        <span class="keyword">return</span> arg</span><br><span class="line"></span><br><span class="line"><span class="meta">    @expose()</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">kwargs</span>(<span class="params">self, **kwargs</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">str</span>(kwargs)</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ curl http://localhost:8080/?arg=foo</span><br><span class="line">foo</span><br><span class="line">$ curl http://localhost:8080/kwargs?a=1&amp;b=2&amp;c=3</span><br><span class="line">&#123;u<span class="string">&#x27;a&#x27;</span>: u<span class="string">&#x27;1&#x27;</span>, u<span class="string">&#x27;c&#x27;</span>: u<span class="string">&#x27;3&#x27;</span>, u<span class="string">&#x27;b&#x27;</span>: u<span class="string">&#x27;2&#x27;</span>&#125;</span><br></pre></td></tr></table></figure>

<p>HTTP POST 请求 body 中的变量也可以达到同样的效果：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">from pecan import expose</span><br><span class="line"></span><br><span class="line">class RootController(object):</span><br><span class="line">    @expose()</span><br><span class="line">    def index(self, arg):</span><br><span class="line">        <span class="built_in">return</span> arg</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ curl -X POST <span class="string">&quot;http://localhost:8080/&quot;</span> -H <span class="string">&quot;Content-Type: application/x-www-form-urlencoded&quot;</span> -d <span class="string">&quot;arg=foo&quot;</span></span><br><span class="line">foo</span><br></pre></td></tr></table></figure>

<h2 id="Pecan-中的模板"><a href="#Pecan-中的模板" class="headerlink" title="Pecan 中的模板"></a>Pecan 中的模板</h2><p>Pecan 支持各种模板引擎，而且也很容易对其进行扩展以添加新的模板引擎。当前，Pecan 支持 <code>Mako</code>、<code>Genshi</code>、<code>Kajiki</code>、<code>Jinja2</code>、<code>Json</code> 的模板引擎。默认的模板引擎是 mako，可以在应用程序中通过 <code>default_renderer</code> 修改模板引擎。</p>
<p>通过 expose() 装饰器的 <code>template</code> 参数，可以指定控制器方法所需要使用的模板文件：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MyController</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line"><span class="meta">    @expose(<span class="params"><span class="string">&#x27;path/to/mako/template.html&#x27;</span></span>)</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">index</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">dict</span>(message=<span class="string">&#x27;I am a mako template&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>expose() 方法会使用默认的模板引擎来对模板文件进行渲染，除非模板文件中显式指定了模板引擎：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@expose(<span class="params"><span class="string">&#x27;kajiki:path/to/kajiki/template.html&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">my_controller</span>(<span class="params">self</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">dict</span>(message=<span class="string">&#x27;I am a kajiki template&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>override_template() 允许你覆盖控制器方法中所要使用的模板文件。而render() 允许你使用 Pecan 模板框架手动进行渲染：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@expose()</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">controller</span>(<span class="params">self</span>):</span><br><span class="line">    <span class="keyword">return</span> render(<span class="string">&#x27;my_template.html&#x27;</span>, <span class="built_in">dict</span>(message=<span class="string">&#x27;I am the namespace&#x27;</span>))</span><br></pre></td></tr></table></figure>

<p>为了自定义渲染器，可以创建一个自定义类，其实现了渲染器协议：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MyRenderer</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, path, extra_vars</span>):</span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">        Your renderer is provided with a path to templates,</span></span><br><span class="line"><span class="string">        as configured by your application, and any extra</span></span><br><span class="line"><span class="string">        template variables, also as configured</span></span><br><span class="line"><span class="string">        &#x27;&#x27;&#x27;</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">render</span>(<span class="params">self, template_path, namespace</span>):</span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">        Lookup the template based on the path, and render</span></span><br><span class="line"><span class="string">        your output based upon the supplied namespace</span></span><br><span class="line"><span class="string">        dictionary, as returned from the controller.</span></span><br><span class="line"><span class="string">        &#x27;&#x27;&#x27;</span></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">str</span>(namespace)</span><br></pre></td></tr></table></figure>

<h2 id="使用-Generic-控制器编写-RESTful-web-服务"><a href="#使用-Generic-控制器编写-RESTful-web-服务" class="headerlink" title="使用 Generic 控制器编写 RESTful web 服务"></a>使用 Generic 控制器编写 RESTful web 服务</h2><p>通过 Pecan 的 generic 控制器，简化了 RESTful web 服务的编写，因为 <code>通用控制器</code> 允许你基于请求方法来重载 URL。下面是一个例子程序：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pecan <span class="keyword">import</span> abort, expose</span><br><span class="line"></span><br><span class="line"><span class="comment"># Note: this is *not* thread-safe.  In real life, use a persistent data store.</span></span><br><span class="line">BOOKS = &#123;</span><br><span class="line">    <span class="string">&#x27;0&#x27;</span>: <span class="string">&#x27;The Last of the Mohicans&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;1&#x27;</span>: <span class="string">&#x27;Catch-22&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BookController</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, id_</span>):</span><br><span class="line">        self.id_ = id_</span><br><span class="line">        <span class="keyword">assert</span> self.book</span><br><span class="line"></span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">book</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">if</span> self.id_ <span class="keyword">in</span> BOOKS:</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">dict</span>(<span class="built_in">id</span>=self.id_, name=BOOKS[self.id_])</span><br><span class="line">        abort(<span class="number">404</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># HTTP GET /&lt;id&gt;/</span></span><br><span class="line"><span class="meta">    @expose(<span class="params">generic=<span class="literal">True</span>, template=<span class="string">&#x27;json&#x27;</span></span>)</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">index</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> self.book</span><br><span class="line"></span><br><span class="line">    <span class="comment"># HTTP PUT /&lt;id&gt;/</span></span><br><span class="line"><span class="meta">    @index.when(<span class="params">method=<span class="string">&#x27;PUT&#x27;</span>, template=<span class="string">&#x27;json&#x27;</span></span>)</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">index_PUT</span>(<span class="params">self, **kw</span>):</span><br><span class="line">        BOOKS[self.id_] = kw[<span class="string">&#x27;name&#x27;</span>]</span><br><span class="line">        <span class="keyword">return</span> self.book</span><br><span class="line"></span><br><span class="line">    <span class="comment"># HTTP DELETE /&lt;id&gt;/</span></span><br><span class="line"><span class="meta">    @index.when(<span class="params">method=<span class="string">&#x27;DELETE&#x27;</span>, template=<span class="string">&#x27;json&#x27;</span></span>)</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">index_DELETE</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">del</span> BOOKS[self.id_]</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">dict</span>()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">RootController</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line"></span><br><span class="line"><span class="meta">    @expose()</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_lookup</span>(<span class="params">self, id_, *remainder</span>):</span><br><span class="line">        <span class="keyword">return</span> BookController(id_), remainder</span><br><span class="line"></span><br><span class="line">    <span class="comment"># HTTP GET /</span></span><br><span class="line"><span class="meta">    @expose(<span class="params">generic=<span class="literal">True</span>, template=<span class="string">&#x27;json&#x27;</span></span>)</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">index</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> [<span class="built_in">dict</span>(<span class="built_in">id</span>=k, name=v) <span class="keyword">for</span> k, v <span class="keyword">in</span> BOOKS.items()]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># HTTP POST /</span></span><br><span class="line"><span class="meta">    @index.when(<span class="params">method=<span class="string">&#x27;POST&#x27;</span>, template=<span class="string">&#x27;json&#x27;</span></span>)</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">index_POST</span>(<span class="params">self, **kw</span>):</span><br><span class="line">        id_ = <span class="built_in">str</span>(<span class="built_in">len</span>(BOOKS))</span><br><span class="line">        BOOKS[id_] = kw[<span class="string">&#x27;name&#x27;</span>]</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">dict</span>(<span class="built_in">id</span>=id_, name=kw[<span class="string">&#x27;name&#x27;</span>])</span><br></pre></td></tr></table></figure>

<h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ul>
<li><a target="_blank" rel="noopener" href="https://pecan.readthedocs.io/en/latest/">Pecan 官方文档</a></li>
</ul>

    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/fuchencong.github.io/tags/Python/" rel="tag"># Python</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/fuchencong.github.io/2022/01/21/memory-grandma/" rel="prev" title="怀念外婆">
      <i class="fa fa-chevron-left"></i> 怀念外婆
    </a></div>
      <div class="post-nav-item">
    <a href="/fuchencong.github.io/2021/12/10/python-paste-deploy/" rel="next" title="Python PasteDeploy 详解">
      Python PasteDeploy 详解 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%89%E8%A3%85-Pecan"><span class="nav-number">1.</span> <span class="nav-text">安装 Pecan</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%89%9B%E5%88%80%E5%B0%8F%E8%AF%95"><span class="nav-number">2.</span> <span class="nav-text">牛刀小试</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E5%85%A5%E5%8F%A3%E7%82%B9"><span class="nav-number">2.1.</span> <span class="nav-text">应用程序入口点</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Controller-%E5%92%8C-%E8%B7%AF%E7%94%B1"><span class="nav-number">3.</span> <span class="nav-text">Controller 和 路由</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AF%BC%E5%87%BA-controller"><span class="nav-number">3.1.</span> <span class="nav-text">导出 controller</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8C%87%E5%AE%9A%E6%98%BE%E5%BC%8F%E7%9A%84%E8%B7%AF%E5%BE%84%E5%88%86%E6%AE%B5"><span class="nav-number">3.2.</span> <span class="nav-text">指定显式的路径分段</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9F%BA%E4%BA%8E%E8%AF%B7%E6%B1%82%E6%96%B9%E6%B3%95%E8%BF%9B%E8%A1%8C%E8%B7%AF%E7%94%B1"><span class="nav-number">3.3.</span> <span class="nav-text">基于请求方法进行路由</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8-lookup-%E8%B7%AF%E7%94%B1%E5%88%B0-Subcontrollers"><span class="nav-number">3.4.</span> <span class="nav-text">使用 _lookup 路由到 Subcontrollers</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#default-%E6%96%B9%E6%B3%95"><span class="nav-number">3.5.</span> <span class="nav-text">_default() 方法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#route-%E8%87%AA%E5%AE%9A%E4%B9%89%E8%B7%AF%E7%94%B1"><span class="nav-number">3.6.</span> <span class="nav-text">_route 自定义路由</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%92%8C-Request-%E5%92%8C-Response-%E5%AF%B9%E8%B1%A1%E8%BF%9B%E8%A1%8C%E4%BA%A4%E4%BA%92"><span class="nav-number">4.</span> <span class="nav-text">和 Request 和 Response 对象进行交互</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8E%A7%E5%88%B6%E5%99%A8%E5%8F%82%E6%95%B0"><span class="nav-number">4.1.</span> <span class="nav-text">控制器参数</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Pecan-%E4%B8%AD%E7%9A%84%E6%A8%A1%E6%9D%BF"><span class="nav-number">5.</span> <span class="nav-text">Pecan 中的模板</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8-Generic-%E6%8E%A7%E5%88%B6%E5%99%A8%E7%BC%96%E5%86%99-RESTful-web-%E6%9C%8D%E5%8A%A1"><span class="nav-number">6.</span> <span class="nav-text">使用 Generic 控制器编写 RESTful web 服务</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Reference"><span class="nav-number">7.</span> <span class="nav-text">Reference</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="fuchencong"
      src="/fuchencong.github.io/images/logo.jpeg">
  <p class="site-author-name" itemprop="name">fuchencong</p>
  <div class="site-description" itemprop="description">Having dreams is what makes life tolerable.</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/fuchencong.github.io/archives/">
        
          <span class="site-state-item-count">66</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/fuchencong.github.io/categories/">
          
        <span class="site-state-item-count">12</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/fuchencong.github.io/tags/">
          
        <span class="site-state-item-count">22</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/fuchencong" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;fuchencong" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:fuchencong@163.com" title="E-Mail → mailto:fuchencong@163.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">fuchencong</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/fuchencong.github.io/lib/anime.min.js"></script>
  <script src="/fuchencong.github.io/lib/velocity/velocity.min.js"></script>
  <script src="/fuchencong.github.io/lib/velocity/velocity.ui.min.js"></script>

<script src="/fuchencong.github.io/js/utils.js"></script>

<script src="/fuchencong.github.io/js/motion.js"></script>


<script src="/fuchencong.github.io/js/schemes/muse.js"></script>


<script src="/fuchencong.github.io/js/next-boot.js"></script>




  















  

  

</body>
</html>
